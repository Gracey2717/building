try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="5b6c1b88-8a01-40a9-a7a2-bceeedfc8230",e._sentryDebugIdIdentifier="sentry-dbid-5b6c1b88-8a01-40a9-a7a2-bceeedfc8230")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4986,7006],{1128:(e,n,t)=>{"use strict";t.d(n,{_:()=>N});var a=t(80263),s=t(53434),r=t.n(s),l=t(54753),i=t(99865),o=t(40260),c=t(518),d=t(37926),u=t(15601),m=t.n(u),_=t(24400),p=t(53239),E=t(75232),h=t(88602),g=t(34531),f=t(55219),v=t(2359);let N=e=>{let{format:n,highlightedValue:t,highlightedLabel:s,hideHighlightedValue:u=!1,title:N,minimalHeader:x=!1,hideChartType:b=!1,chartStyle:y="bar",onChartStyleChange:I,showMaxValue:T=!1,setShowMaxValue:S,docsUrl:A,syncId:C,data:R,xAxisKey:L,yAxisKey:O,xAxisIsDate:j=!0,displayDateInUtc:D,customDateFormat:F,valuePrecision:w=2,shouldFormatBytes:k=!1,isNetworkChart:H=!1,attributes:U,sql:P}=e,{hoveredIndex:M,isHovered:q,isCurrentChart:G,setHover:W,clearHover:K}=(0,v.Z)(C||"default"),[B,Y]=(0,p.useState)(t),[Q,z]=(0,p.useState)(s),{ref:V}=(0,E.g)();(0,_.useRouter)(),(0,p.useEffect)(()=>{if(C&&null!==M&&q&&R&&L&&O){let t=R[M];if(t){let a=t[O];if(U&&U.length>1){var e,n;let s=null!=(n=null==U||null==(e=U.filter(e=>e.omitFromTotal||e.isMaxValue||"reference-line"===e.provider))?void 0:e.map(e=>e.attribute))?n:[];a=Object.entries(t).filter(e=>{let[n,t]=e;return"number"==typeof t&&"timestamp"!==n&&"period_start"!==n&&!s.includes(n)&&U.some(e=>e.attribute===n&&!1!==e.enabled)}).reduce((e,n)=>{let[t,a]=n;return e+a},0)}Y(a);let l=s;j&&t[L]?l=(e=>D?r()(e).utc():r()(e))(t[L]).format(F||"YYYY-MM-DD HH:mm:ss"):t[L]&&(l=t[L]),z(l)}}else Y(t),z(s)},[M,q,C,R,L,O,j,D,F,t,s,U]);let X=(0,a.jsxs)("div",{className:"flex flex-row items-center gap-x-2",children:[(0,a.jsx)("h3",{className:"text-foreground-lighter "+(x?"text-xs":"text-sm"),children:N}),A&&(0,a.jsx)(h.G,{type:"text",className:"px-1",asChild:!0,tooltip:{content:{side:"top",text:"Read docs"}},children:(0,a.jsx)(m(),{href:A,target:"_blank",children:(0,a.jsx)(l.A,{className:"w-4 h-4 text-foreground-lighter"})})})]}),J=(0,a.jsx)("h4",{className:"text-foreground text-xl font-normal ".concat(x?"text-base":"text-2xl"),children:void 0!==B&&(e=>{if("number"!=typeof e)return e;if("function"==typeof n)return n(e);if(k){let n=H?Math.abs(e):e;return(0,g.z3)(n,w)}return(0,f.Eg)(e,w)})(B)}),$=(0,a.jsx)("h4",{className:"text-foreground-lighter text-xs",children:Q});if(x)return(0,a.jsxs)("div",{className:"flex flex-row items-center gap-x-4",style:{minHeight:"1.8rem"},children:[N&&X,(0,a.jsxs)("div",{className:"flex flex-row items-baseline gap-x-2",children:[void 0!==t&&!u&&J,$]})]});let Z=void 0!==t&&!u;return(0,a.jsxs)("div",{className:"flex-grow flex justify-between items-start min-h-16","data-sentry-component":"ChartHeader","data-sentry-source-file":"ChartHeader.tsx",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[N&&X,(0,a.jsxs)("div",{className:"h-4",children:[Z&&J,$]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[P?(0,a.jsx)(h.G,{type:"default",className:"px-1.5",asChild:!0,tooltip:{content:{side:"top",text:"Open in Log Explorer"}},children:(0,a.jsx)(m(),{href:"/project/".concat(V,"/logs/explorer?q=").concat(encodeURIComponent(P)),children:(0,a.jsx)(i.A,{className:"w-4 h-4 text-foreground-lighter"})})}):null,!b&&I&&(0,a.jsx)(h.G,{type:"default",className:"px-1.5",icon:"bar"===y?(0,a.jsx)(o.A,{}):(0,a.jsx)(c.A,{}),onClick:()=>I("bar"===y?"line":"bar"),tooltip:{content:{side:"top",text:"View as ".concat("bar"===y?"line chart":"bar chart")}}}),S&&(0,a.jsx)(h.G,{type:T?"default":"dashed",className:"px-1.5",icon:(0,a.jsx)(d.A,{className:T?"text-foreground-light":"text-foreground-lighter"}),onClick:()=>S(!T),tooltip:{content:{side:"top",text:"".concat(T?"Hide":"Show"," limit")}}})]})]})}},2359:(e,n,t)=>{"use strict";t.d(n,{Z:()=>c});var a=t(53239);let s="supabase-chart-hover-sync-enabled",r="supabase-chart-tooltip-sync-enabled",l={hoveredIndex:null,hoveredChart:null,syncHover:!1,syncTooltip:!1},i=new Set;try{let e=localStorage.getItem(s),n=localStorage.getItem(r);null!==e&&(l.syncHover=JSON.parse(e)),null!==n&&(l.syncTooltip=JSON.parse(n))}catch(e){console.warn("Failed to load chart sync settings from localStorage:",e)}function o(e){let n=l;if(l={...l,...e},void 0!==e.syncHover)try{localStorage.setItem(s,JSON.stringify(l.syncHover))}catch(e){console.warn("Failed to save chart hover sync setting to localStorage:",e)}if(void 0!==e.syncTooltip)try{localStorage.setItem(r,JSON.stringify(l.syncTooltip))}catch(e){console.warn("Failed to save chart tooltip sync setting to localStorage:",e)}JSON.stringify(n)!==JSON.stringify(l)&&i.forEach(e=>e(l))}function c(e){let[n,t]=(0,a.useState)(l);(0,a.useEffect)(()=>{let e=e=>{t(e)};return i.add(e),()=>{i.delete(e)}},[]);let s=(0,a.useCallback)(n=>{l.syncHover?o({hoveredIndex:n,hoveredChart:null!==n?e:null}):t(t=>({...t,hoveredIndex:n,hoveredChart:null!==n?e:null}))},[e]),r=(0,a.useCallback)(()=>{l.syncHover?o({hoveredIndex:null,hoveredChart:null}):t(e=>({...e,hoveredIndex:null,hoveredChart:null}))},[]),c=(0,a.useCallback)(e=>{o({syncHover:e,...!1===e&&{syncTooltip:!1}})},[]),d=(0,a.useCallback)(e=>{o({syncTooltip:e,...!0===e&&{syncHover:!0}})},[]),u=n.hoveredChart===e,m=n.syncHover&&null!==n.hoveredChart&&!u;return{hoveredIndex:m||u?n.hoveredIndex:null,syncHover:n.syncHover,syncTooltip:n.syncTooltip,hoveredChart:n.hoveredChart,setHover:s,clearHover:r,setSyncHover:c,setSyncTooltip:d,isHovered:null!==n.hoveredIndex&&(u||m),isCurrentChart:u}}},5013:(e,n,t)=>{"use strict";t.d(n,{n:()=>s,P:()=>r});var a=t(26616);let s=t.n(a)()("\n      DROP TYPE IF EXISTS pg_temp.tabledefs CASCADE;\n      CREATE TYPE pg_temp.tabledefs AS ENUM ('PKEY_INTERNAL','PKEY_EXTERNAL','FKEYS_INTERNAL', 'FKEYS_EXTERNAL', 'COMMENTS', 'FKEYS_NONE', 'INCLUDE_TRIGGERS', 'NO_TRIGGERS');\n\n      -- SELECT * FROM pg_temp.pg_get_coldef('sample','orders','id');\n      -- DROP FUNCTION pg_temp.pg_get_coldef(text,text,text,boolean);\n      CREATE OR REPLACE FUNCTION pg_temp.pg_get_coldef(\n        in_schema text,\n        in_table  text,\n        in_column text,\n        oldway    boolean default False\n      )\n      RETURNS text\n      LANGUAGE plpgsql VOLATILE\n      AS\n      $$\n      DECLARE\n      v_coldef     text;\n      v_dt1        text;\n      v_dt2        text;\n      v_dt3        text;\n      v_nullable   boolean;\n      v_position   int;\n      v_identity   text;\n      v_generated  text;\n      v_hasdflt    boolean;\n      v_dfltexpr   text;\n\n      BEGIN\n        IF oldway THEN\n          SELECT pg_catalog.format_type(a.atttypid, a.atttypmod) INTO v_coldef FROM pg_namespace n, pg_class c, pg_attribute a, pg_type t\n          WHERE n.nspname = in_schema AND n.oid = c.relnamespace AND c.relname = in_table AND a.attname = in_column and a.attnum > 0 AND a.attrelid = c.oid AND a.atttypid = t.oid ORDER BY a.attnum;\n          -- RAISE NOTICE 'DEBUG: oldway=%',v_coldef;\n        ELSE\n          -- a.attrelid::regclass::text, a.attname\n          SELECT CASE WHEN a.atttypid = ANY ('{int,int8,int2}'::regtype[]) AND EXISTS (SELECT FROM pg_attrdef ad WHERE ad.adrelid = a.attrelid AND ad.adnum   = a.attnum AND\n          pg_get_expr(ad.adbin, ad.adrelid) = 'nextval(''' || (pg_get_serial_sequence (a.attrelid::regclass::text, a.attname))::regclass || '''::regclass)') THEN CASE a.atttypid\n          WHEN 'int'::regtype  THEN 'serial' WHEN 'int8'::regtype THEN 'bigserial' WHEN 'int2'::regtype THEN 'smallserial' END ELSE format_type(a.atttypid, a.atttypmod) END AS data_type\n          INTO v_coldef FROM pg_namespace n, pg_class c, pg_attribute a, pg_type t\n          WHERE n.nspname = in_schema AND n.oid = c.relnamespace AND c.relname = in_table AND a.attname = in_column and a.attnum > 0 AND a.attrelid = c.oid AND a.atttypid = t.oid ORDER BY a.attnum;\n          -- RAISE NOTICE 'DEBUG: newway=%',v_coldef;\n\n          -- Issue#24: not implemented yet\n          -- might replace with this below to do more detailed parsing...\n          -- SELECT a.atttypid::regtype AS dt1, format_type(a.atttypid, a.atttypmod) as dt2, t.typname as dt3, CASE WHEN not(a.attnotnull) THEN True ELSE False END AS nullable,\n          -- a.attnum, a.attidentity, a.attgenerated, a.atthasdef, pg_get_expr(ad.adbin, ad.adrelid) dfltexpr\n          -- INTO v_dt1, v_dt2, v_dt3, v_nullable, v_position, v_identity, v_generated, v_hasdflt, v_dfltexpr\n          -- FROM pg_attribute a JOIN pg_class c ON (a.attrelid = c.oid) JOIN pg_type t ON (a.atttypid = t.oid) LEFT JOIN pg_attrdef ad ON (a.attrelid = ad.adrelid AND a.attnum = ad.adnum)\n          -- WHERE c.relkind in ('r','p') AND a.attnum > 0 AND NOT a.attisdropped AND c.relnamespace::regnamespace::text = in_schema AND c.relname = in_table AND a.attname = in_column;\n          -- RAISE NOTICE 'schema=%  table=%  column=%  dt1=%  dt2=%  dt3=%  nullable=%  pos=%  identity=%   generated=%  HasDefault=%  DeftExpr=%', in_schema, in_table, in_column, v_dt1,v_dt2,v_dt3,v_nullable,v_position,v_identity,v_generated,v_hasdflt,v_dfltexpr;\n        END IF;\n        RETURN v_coldef;\n      END;\n      $$;\n\n      -- SELECT * FROM pg_temp.pg_get_tabledef('sample', 'address', false);\n      DROP FUNCTION IF EXISTS pg_temp.pg_get_tabledef(character varying,character varying,boolean,tabledefs[]);\n      CREATE OR REPLACE FUNCTION pg_temp.pg_get_tabledef(\n        in_schema varchar,\n        in_table varchar,\n        _verbose boolean,\n        VARIADIC arr pg_temp.tabledefs[] DEFAULT '{}':: pg_temp.tabledefs[]\n      )\n      RETURNS text\n      LANGUAGE plpgsql VOLATILE\n      AS\n      $$\n        DECLARE\n          v_qualified text := '';\n          v_table_ddl text;\n          v_table_oid int;\n          v_colrec record;\n          v_constraintrec record;\n          v_trigrec       record;\n          v_indexrec record;\n          v_rec           record;\n          v_constraint_name text;\n          v_constraint_def  text;\n          v_pkey_def        text := '';\n          v_fkey_def        text := '';\n          v_fkey_defs       text := '';\n          v_trigger text := '';\n          v_partition_key text := '';\n          v_partbound text;\n          v_parent text;\n          v_parent_schema text;\n          v_persist text;\n          v_temp  text := '';\n          v_temp2 text;\n          v_relopts text;\n          v_tablespace text;\n          v_pgversion int;\n          bSerial boolean;\n          bPartition boolean;\n          bInheritance boolean;\n          bRelispartition boolean;\n          constraintarr text[] := '{}';\n          constraintelement text;\n          bSkip boolean;\n          bVerbose boolean := False;\n          v_cnt1   integer;\n          v_cnt2   integer;\n          search_path_old text := '';\n          search_path_new text := '';\n          v_partial    boolean;\n          v_pos        integer;\n\n          -- assume defaults for ENUMs at the getgo\n          pkcnt            int := 0;\n          fkcnt            int := 0;\n          trigcnt          int := 0;\n          cmtcnt           int := 0;\n          pktype           pg_temp.tabledefs := 'PKEY_INTERNAL';\n          fktype           pg_temp.tabledefs := 'FKEYS_INTERNAL';\n          trigtype         pg_temp.tabledefs := 'NO_TRIGGERS';\n          arglen           integer;\n          vargs            text;\n          avarg            pg_temp.tabledefs;\n\n          -- exception variables\n          v_ret            text;\n          v_diag1          text;\n          v_diag2          text;\n          v_diag3          text;\n          v_diag4          text;\n          v_diag5          text;\n          v_diag6          text;\n\n        BEGIN\n          SET client_min_messages = 'notice';\n          IF _verbose THEN bVerbose = True; END IF;\n\n          -- v17 fix: handle case-sensitive\n          -- v_qualified = in_schema || '.' || in_table;\n\n          arglen := array_length($4, 1);\n          IF arglen IS NULL THEN\n              -- nothing to do, so assume defaults\n              NULL;\n          ELSE\n              -- loop thru args\n              -- IF 'NO_TRIGGERS' = ANY ($4)\n              -- select array_to_string($4, ',', '***') INTO vargs;\n              IF bVerbose THEN RAISE NOTICE 'arguments=%', $4; END IF;\n              FOREACH avarg IN ARRAY $4 LOOP\n                  IF bVerbose THEN RAISE NOTICE 'arg=%', avarg; END IF;\n                  IF avarg = 'FKEYS_INTERNAL' OR avarg = 'FKEYS_EXTERNAL' OR avarg = 'FKEYS_NONE' THEN\n                      fkcnt = fkcnt + 1;\n                      fktype = avarg;\n                  ELSEIF avarg = 'INCLUDE_TRIGGERS' OR avarg = 'NO_TRIGGERS' THEN\n                      trigcnt = trigcnt + 1;\n                      trigtype = avarg;\n                  ELSEIF avarg = 'PKEY_EXTERNAL' THEN\n                      pkcnt = pkcnt + 1;\n                      pktype = avarg;\n                  ELSEIF avarg = 'COMMENTS' THEN\n                      cmtcnt = cmtcnt + 1;\n\n                  END IF;\n              END LOOP;\n              IF fkcnt > 1 THEN\n                  RAISE WARNING 'Only one foreign key option can be provided. You provided %', fkcnt;\n                  RETURN '';\n              ELSEIF trigcnt > 1 THEN\n                  RAISE WARNING 'Only one trigger option can be provided. You provided %', trigcnt;\n                  RETURN '';\n              ELSEIF pkcnt > 1 THEN\n                  RAISE WARNING 'Only one pkey option can be provided. You provided %', pkcnt;\n                  RETURN '';\n              ELSEIF cmtcnt > 1 THEN\n                  RAISE WARNING 'Only one comments option can be provided. You provided %', cmtcnt;\n                  RETURN '';\n\n              END IF;\n          END IF;\n\n          SELECT c.oid, (select setting from pg_settings where name = 'server_version_num') INTO v_table_oid, v_pgversion FROM pg_catalog.pg_class c LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n          WHERE c.relkind in ('r','p') AND c.relname = in_table AND n.nspname = in_schema;\n\n        -- set search_path = public before we do anything to force explicit schema qualification but dont forget to set it back before exiting...\n          SELECT setting INTO search_path_old FROM pg_settings WHERE name = 'search_path';\n\n          -- RAISE NOTICE 'DEBUG tableddl: saving old search_path: ***%***', search_path_old;\n          EXECUTE 'SET search_path = \"public\"';\n          SELECT setting INTO search_path_new FROM pg_settings WHERE name = 'search_path';\n          -- RAISE NOTICE 'DEBUG tableddl: using new search path=***%***', search_path_new;\n\n          -- throw an error if table was not found\n          IF (v_table_oid IS NULL) THEN\n            RAISE EXCEPTION 'table does not exist';\n          END IF;\n\n          -- get user-defined tablespaces if applicable\n          SELECT tablespace INTO v_temp FROM pg_tables WHERE schemaname = in_schema and tablename = in_table and tablespace IS NOT NULL;\n          IF v_temp IS NULL THEN\n            v_tablespace := 'TABLESPACE pg_default';\n          ELSE\n            v_tablespace := 'TABLESPACE ' || v_temp;\n          END IF;\n\n          -- also see if there are any SET commands for this table, ie, autovacuum_enabled=off, fillfactor=70\n          WITH relopts AS (SELECT unnest(c.reloptions) relopts FROM pg_class c, pg_namespace n WHERE n.nspname = in_schema and n.oid = c.relnamespace and c.relname = in_table)\n          SELECT string_agg(r.relopts, ', ') as relopts INTO v_temp from relopts r;\n          IF v_temp IS NULL THEN\n            v_relopts := '';\n          ELSE\n            v_relopts := ' WITH (' || v_temp || ')';\n          END IF;\n\n          -- -----------------------------------------------------------------------------------\n          -- Create table defs for partitions/children using inheritance or declarative methods.\n          -- inheritance: pg_class.relkind = 'r'   pg_class.relispartition=false   pg_class.relpartbound is NULL\n          -- declarative: pg_class.relkind = 'r'   pg_class.relispartition=true    pg_class.relpartbound is NOT NULL\n          -- -----------------------------------------------------------------------------------\n          v_partbound := '';\n          bPartition := False;\n          bInheritance := False;\n          IF v_pgversion < 100000 THEN\n            -- Issue#11: handle parent schema\n            SELECT c2.relname parent, c2.relnamespace::regnamespace INTO v_parent, v_parent_schema from pg_class c1, pg_namespace n, pg_inherits i, pg_class c2\n            WHERE n.nspname = in_schema and n.oid = c1.relnamespace and c1.relname = in_table and c1.oid = i.inhrelid and i.inhparent = c2.oid and c1.relkind = 'r';\n            IF (v_parent IS NOT NULL) THEN\n              bPartition   := True;\n              bInheritance := True;\n            END IF;\n          ELSE\n            -- Issue#11: handle parent schema\n            SELECT c2.relname parent, c1.relispartition, pg_get_expr(c1.relpartbound, c1.oid, true), c2.relnamespace::regnamespace INTO v_parent, bRelispartition, v_partbound, v_parent_schema from pg_class c1, pg_namespace n, pg_inherits i, pg_class c2\n            WHERE n.nspname = in_schema and n.oid = c1.relnamespace and c1.relname = in_table and c1.oid = i.inhrelid and i.inhparent = c2.oid and c1.relkind = 'r';\n            IF (v_parent IS NOT NULL) THEN\n              bPartition   := True;\n              IF bRelispartition THEN\n                bInheritance := False;\n              ELSE\n                bInheritance := True;\n              END IF;\n            END IF;\n          END IF;\n          IF bPartition THEN\n            --Issue#17 fix for case-sensitive tables\n            -- SELECT count(*) INTO v_cnt1 FROM information_schema.tables t WHERE EXISTS (SELECT REGEXP_MATCHES(s.table_name, '([A-Z]+)','g') FROM information_schema.tables s\n            -- WHERE t.table_schema=s.table_schema AND t.table_name=s.table_name AND t.table_schema = quote_ident(in_schema) AND t.table_name = quote_ident(in_table) AND t.table_type = 'BASE TABLE');\n            SELECT count(*) INTO v_cnt1 FROM information_schema.tables t WHERE EXISTS (SELECT REGEXP_MATCHES(s.table_name, '([A-Z]+)','g') FROM information_schema.tables s\n            WHERE t.table_schema=s.table_schema AND t.table_name=s.table_name AND t.table_schema = in_schema AND t.table_name = in_table AND t.table_type = 'BASE TABLE');\n\n            --Issue#19 put double-quotes around SQL keyword column names\n            -- Issue#121: fix keyword lookup for table name not column name that does not apply here\n            -- SELECT COUNT(*) INTO v_cnt2 FROM pg_get_keywords() WHERE word = v_colrec.column_name AND catcode = 'R';\n            SELECT COUNT(*) INTO v_cnt2 FROM pg_get_keywords() WHERE word = in_table AND catcode = 'R';\n\n            IF bInheritance THEN\n              -- inheritance-based\n              IF v_cnt1 > 0 OR v_cnt2 > 0 THEN\n                v_table_ddl := 'CREATE TABLE ' || in_schema || '.\"' || in_table || '\"( '|| E'\\n';\n              ELSE\n                v_table_ddl := 'CREATE TABLE ' || in_schema || '.' || in_table || '( '|| E'\\n';\n              END IF;\n\n              -- Jump to constraints section to add the check constraints\n            ELSE\n              -- declarative-based\n              IF v_relopts <> '' THEN\n                IF v_cnt1 > 0 OR v_cnt2 > 0 THEN\n                  v_table_ddl := 'CREATE TABLE ' || in_schema || '.\"' || in_table || '\" PARTITION OF ' || in_schema || '.' || v_parent || ' ' || v_partbound || v_relopts || ' ' || v_tablespace || '; ' || E'\\n';\n                ELSE\n                  v_table_ddl := 'CREATE TABLE ' || in_schema || '.' || in_table || ' PARTITION OF ' || in_schema || '.' || v_parent || ' ' || v_partbound || v_relopts || ' ' || v_tablespace || '; ' || E'\\n';\n                END IF;\n              ELSE\n                IF v_cnt1 > 0 OR v_cnt2 > 0 THEN\n                  v_table_ddl := 'CREATE TABLE ' || in_schema || '.\"' || in_table || '\" PARTITION OF ' || in_schema || '.' || v_parent || ' ' || v_partbound || ' ' || v_tablespace || '; ' || E'\\n';\n                ELSE\n                  v_table_ddl := 'CREATE TABLE ' || in_schema || '.' || in_table || ' PARTITION OF ' || in_schema || '.' || v_parent || ' ' || v_partbound || ' ' || v_tablespace || '; ' || E'\\n';\n                END IF;\n              END IF;\n              -- Jump to constraints and index section to add the check constraints and indexes and perhaps FKeys\n            END IF;\n          END IF;\n          IF bVerbose THEN RAISE NOTICE '(1)tabledef so far: %', v_table_ddl; END IF;\n\n          IF NOT bPartition THEN\n            -- see if this is unlogged or temporary table\n            select c.relpersistence into v_persist from pg_class c, pg_namespace n where n.nspname = in_schema and n.oid = c.relnamespace and c.relname = in_table and c.relkind = 'r';\n            IF v_persist = 'u' THEN\n              v_temp := 'UNLOGGED';\n            ELSIF v_persist = 't' THEN\n              v_temp := 'TEMPORARY';\n            ELSE\n              v_temp := '';\n            END IF;\n          END IF;\n\n          -- start the create definition for regular tables unless we are in progress creating an inheritance-based child table\n          IF NOT bPartition THEN\n            --Issue#17 fix for case-sensitive tables\n            -- SELECT count(*) INTO v_cnt1 FROM information_schema.tables t WHERE EXISTS (SELECT REGEXP_MATCHES(s.table_name, '([A-Z]+)','g') FROM information_schema.tables s\n            -- WHERE t.table_schema=s.table_schema AND t.table_name=s.table_name AND t.table_schema = quote_ident(in_schema) AND t.table_name = quote_ident(in_table) AND t.table_type = 'BASE TABLE');\n            SELECT count(*) INTO v_cnt1 FROM information_schema.tables t WHERE EXISTS (SELECT REGEXP_MATCHES(s.table_name, '([A-Z]+)','g') FROM information_schema.tables s\n            WHERE t.table_schema=s.table_schema AND t.table_name=s.table_name AND t.table_schema = in_schema AND t.table_name = in_table AND t.table_type = 'BASE TABLE');\n            IF v_cnt1 > 0 THEN\n              v_table_ddl := 'CREATE ' || v_temp || ' TABLE ' || in_schema || '.\"' || in_table || '\" (' || E'\\n';\n            ELSE\n              v_table_ddl := 'CREATE ' || v_temp || ' TABLE ' || in_schema || '.' || in_table || ' (' || E'\\n';\n            END IF;\n          END IF;\n          -- RAISE NOTICE 'DEBUG2: tabledef so far: %', v_table_ddl;\n          -- define all of the columns in the table unless we are in progress creating an inheritance-based child table\n          IF NOT bPartition THEN\n            FOR v_colrec IN\n              SELECT c.column_name, c.data_type, c.udt_name, c.udt_schema, c.character_maximum_length, c.is_nullable, c.column_default, c.numeric_precision, c.numeric_scale, c.is_identity, c.identity_generation, c.is_generated, c.generation_expression\n              FROM information_schema.columns c WHERE (table_schema, table_name) = (in_schema, in_table) ORDER BY ordinal_position\n            LOOP\n              IF bVerbose THEN RAISE NOTICE '(col loop) name=%  type=%  udt_name=%  default=%  is_generated=%  gen_expr=%', v_colrec.column_name, v_colrec.data_type, v_colrec.udt_name, v_colrec.column_default, v_colrec.is_generated, v_colrec.generation_expression; END IF;\n\n              -- v17 fix: handle case-sensitive for pg_get_serial_sequence that requires SQL Identifier handling\n              -- SELECT CASE WHEN pg_get_serial_sequence(v_qualified, v_colrec.column_name) IS NOT NULL THEN True ELSE False END into bSerial;\n              SELECT CASE WHEN pg_get_serial_sequence(quote_ident(in_schema) || '.' || quote_ident(in_table), v_colrec.column_name) IS NOT NULL THEN True ELSE False END into bSerial;\n              IF bVerbose THEN\n                -- v17 fix: handle case-sensitive for pg_get_serial_sequence that requires SQL Identifier handling\n                -- SELECT pg_get_serial_sequence(v_qualified, v_colrec.column_name) into v_temp;\n                SELECT pg_get_serial_sequence(quote_ident(in_schema) || '.' || quote_ident(in_table), v_colrec.column_name) into v_temp;\n                IF v_temp IS NULL THEN v_temp = 'NA'; END IF;\n                SELECT pg_temp.pg_get_coldef(in_schema, in_table,v_colrec.column_name) INTO v_diag1;\n                RAISE NOTICE 'DEBUG table: %  Column: %  datatype: %  Serial=%  serialval=%  coldef=%', v_qualified, v_colrec.column_name, v_colrec.data_type, bSerial, v_temp, v_diag1;\n                RAISE NOTICE 'DEBUG tabledef: %', v_table_ddl;\n              END IF;\n\n              --Issue#17 put double-quotes around case-sensitive column names\n              SELECT COUNT(*) INTO v_cnt1 FROM information_schema.columns t WHERE EXISTS (SELECT REGEXP_MATCHES(s.column_name, '([A-Z]+)','g') FROM information_schema.columns s\n              WHERE t.table_schema=s.table_schema and t.table_name=s.table_name and t.column_name=s.column_name AND t.table_schema = quote_ident(in_schema) AND column_name = v_colrec.column_name);\n\n              --Issue#19 put double-quotes around SQL keyword column names\n              SELECT COUNT(*) INTO v_cnt2 FROM pg_get_keywords() WHERE word = v_colrec.column_name AND catcode = 'R';\n\n              IF v_cnt1 > 0 OR v_cnt2 > 0 THEN\n                v_table_ddl := v_table_ddl || '  \"' || v_colrec.column_name || '\" ';\n              ELSE\n                v_table_ddl := v_table_ddl || '  ' || v_colrec.column_name || ' ';\n              END IF;\n\n              -- Issue#23: Handle autogenerated columns and rewrite as a simpler IF THEN ELSE branch instead of a much more complex embedded CASE STATEMENT\n              IF v_colrec.is_generated = 'ALWAYS' and v_colrec.generation_expression IS NOT NULL THEN\n                  -- searchable tsvector GENERATED ALWAYS AS (to_tsvector('simple'::regconfig, COALESCE(translate(email, '@.-'::citext, ' '::text), ''::text)) ) STORED\n                  v_temp = v_colrec.data_type || ' GENERATED ALWAYS AS (' || v_colrec.generation_expression || ') STORED ';\n              ELSEIF v_colrec.udt_name in ('geometry', 'box2d', 'box2df', 'box3d', 'geography', 'geometry_dump', 'gidx', 'spheroid', 'valid_detail') THEN\n                  v_temp = v_colrec.udt_name;\n              ELSEIF v_colrec.data_type = 'USER-DEFINED' THEN\n                  v_temp = v_colrec.udt_schema || '.' || v_colrec.udt_name;\n              ELSEIF v_colrec.data_type = 'ARRAY' THEN\n                    -- Issue#6 fix: handle arrays\n                  v_temp = pg_temp.pg_get_coldef(in_schema, in_table,v_colrec.column_name);\n                  -- v17 fix: handle case-sensitive for pg_get_serial_sequence that requires SQL Identifier handling\n                  -- WHEN pg_get_serial_sequence(v_qualified, v_colrec.column_name) IS NOT NULL\n              ELSEIF pg_get_serial_sequence(quote_ident(in_schema) || '.' || quote_ident(in_table), v_colrec.column_name) IS NOT NULL THEN\n                  -- Issue#8 fix: handle serial. Note: NOT NULL is implied so no need to declare it explicitly\n                  v_temp = pg_temp.pg_get_coldef(in_schema, in_table,v_colrec.column_name);\n              ELSE\n                  v_temp = v_colrec.data_type;\n              END IF;\n              -- RAISE NOTICE 'column def1=%', v_temp;\n\n              -- handle IDENTITY columns\n              IF v_colrec.is_identity = 'YES' THEN\n                  IF v_colrec.identity_generation = 'ALWAYS' THEN\n                      v_temp = v_temp || ' GENERATED ALWAYS AS IDENTITY';\n                  ELSE\n                      v_temp = v_temp || ' GENERATED BY DEFAULT AS IDENTITY';\n                  END IF;\n              ELSEIF v_colrec.character_maximum_length IS NOT NULL THEN\n                  v_temp = v_temp || ('(' || v_colrec.character_maximum_length || ')');\n              ELSEIF v_colrec.numeric_precision > 0 AND v_colrec.numeric_scale > 0 THEN\n                  v_temp = v_temp || '(' || v_colrec.numeric_precision || ',' || v_colrec.numeric_scale || ')';\n              END IF;\n\n              -- Handle NULL/NOT NULL\n              IF bSerial THEN\n                  v_temp = v_temp || ' NOT NULL';\n              ELSEIF v_colrec.is_nullable = 'NO' THEN\n                  v_temp = v_temp || ' NOT NULL';\n              ELSEIF v_colrec.is_nullable = 'YES' THEN\n                  v_temp = v_temp || ' NULL';\n              END IF;\n\n              -- Handle defaults\n              IF v_colrec.column_default IS NOT null AND NOT bSerial THEN\n                  -- RAISE NOTICE 'Setting default for column, %', v_colrec.column_name;\n                  v_temp = v_temp || (' DEFAULT ' || v_colrec.column_default);\n              END IF;\n              v_temp = v_temp || ',' || E'\\n';\n              -- RAISE NOTICE 'column def2=%', v_temp;\n              v_table_ddl := v_table_ddl || v_temp;\n              -- RAISE NOTICE 'tabledef=%', v_table_ddl;\n\n            END LOOP;\n          END IF;\n          IF bVerbose THEN RAISE NOTICE '(2)tabledef so far: %', v_table_ddl; END IF;\n\n          -- define all the constraints: conparentid does not exist pre PGv11\n          IF v_pgversion < 110000 THEN\n            FOR v_constraintrec IN\n              SELECT con.conname as constraint_name, con.contype as constraint_type,\n                CASE\n                  WHEN con.contype = 'p' THEN 1 -- primary key constraint\n                  WHEN con.contype = 'u' THEN 2 -- unique constraint\n                  WHEN con.contype = 'f' THEN 3 -- foreign key constraint\n                  WHEN con.contype = 'c' THEN 4\n                  ELSE 5\n                END as type_rank,\n                pg_get_constraintdef(con.oid) as constraint_definition\n              FROM pg_catalog.pg_constraint con JOIN pg_catalog.pg_class rel ON rel.oid = con.conrelid JOIN pg_catalog.pg_namespace nsp ON nsp.oid = connamespace\n              WHERE nsp.nspname = in_schema AND rel.relname = in_table ORDER BY type_rank\n            LOOP\n              v_constraint_name := v_constraintrec.constraint_name;\n              v_constraint_def  := v_constraintrec.constraint_definition;\n              IF v_constraintrec.type_rank = 1 THEN\n                  IF pkcnt = 0 OR pktype = 'PKEY_INTERNAL' THEN\n                      -- internal def\n                      v_constraint_name := v_constraintrec.constraint_name;\n                      v_constraint_def  := v_constraintrec.constraint_definition;\n                      v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                        || 'CONSTRAINT' || ' '\n                        || v_constraint_name || ' '\n                        || v_constraint_def\n                        || ',' || E'\\n';\n                  ELSE\n                    -- Issue#16 handle external PG def\n                    SELECT 'ALTER TABLE ONLY ' || in_schema || '.' || c.relname || ' ADD CONSTRAINT ' || r.conname || ' ' || pg_catalog.pg_get_constraintdef(r.oid, true) || ';' INTO v_pkey_def\n                    FROM pg_catalog.pg_constraint r, pg_class c, pg_namespace n where r.conrelid = c.oid and  r.contype = 'p' and n.oid = r.connamespace and n.nspname = in_schema AND c.relname = in_table and r.conname = v_constraint_name;\n                  END IF;\n                  IF bPartition THEN\n                    continue;\n                  END IF;\n              ELSIF v_constraintrec.type_rank = 3 THEN\n                  -- handle foreign key constraints\n                  --Issue#22 fix: added FKEY_NONE check\n                  IF fktype = 'FKEYS_NONE' THEN\n                      -- skip\n                      continue;\n                  ELSIF fkcnt = 0 OR fktype = 'FKEYS_INTERNAL' THEN\n                      -- internal def\n                      v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                        || 'CONSTRAINT' || ' '\n                        || v_constraint_name || ' '\n                        || v_constraint_def\n                        || ',' || E'\\n';\n                  ELSE\n                      -- external def\n                      SELECT 'ALTER TABLE ONLY ' || n.nspname || '.' || c2.relname || ' ADD CONSTRAINT ' || r.conname || ' ' || pg_catalog.pg_get_constraintdef(r.oid, true) || ';' INTO v_fkey_def\n                      FROM pg_constraint r, pg_class c1, pg_namespace n, pg_class c2 where r.conrelid = c1.oid and  r.contype = 'f' and n.nspname = in_schema and n.oid = r.connamespace and r.conrelid = c2.oid and c2.relname = in_table;\n                      v_fkey_defs = v_fkey_defs || v_fkey_def || E'\\n';\n                  END IF;\n              ELSE\n                  -- handle all other constraints besides PKEY and FKEYS as internal defs by default\n                  v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                    || 'CONSTRAINT' || ' '\n                    || v_constraint_name || ' '\n                    || v_constraint_def\n                    || ',' || E'\\n';\n              END IF;\n              if bVerbose THEN RAISE NOTICE 'DEBUG4: constraint name=% constraint_def=%', v_constraint_name,v_constraint_def; END IF;\n              constraintarr := constraintarr || v_constraintrec.constraint_name:: text;\n\n            END LOOP;\n          ELSE\n            -- handle PG versions 11 and up\n            -- Issue#20: Fix logic for external PKEY and FKEYS\n            FOR v_constraintrec IN\n              SELECT con.conname as constraint_name, con.contype as constraint_type,\n                CASE\n                  WHEN con.contype = 'p' THEN 1 -- primary key constraint\n                  WHEN con.contype = 'u' THEN 2 -- unique constraint\n                  WHEN con.contype = 'f' THEN 3 -- foreign key constraint\n                  WHEN con.contype = 'c' THEN 4\n                  ELSE 5\n                END as type_rank,\n                pg_get_constraintdef(con.oid) as constraint_definition\n              FROM pg_catalog.pg_constraint con JOIN pg_catalog.pg_class rel ON rel.oid = con.conrelid JOIN pg_catalog.pg_namespace nsp ON nsp.oid = connamespace\n              WHERE nsp.nspname = in_schema AND rel.relname = in_table\n                    --Issue#13 added this condition:\n                    AND con.conparentid = 0\n                    ORDER BY type_rank\n            LOOP\n              v_constraint_name := v_constraintrec.constraint_name;\n              v_constraint_def  := v_constraintrec.constraint_definition;\n              IF v_constraintrec.type_rank = 1 THEN\n                  IF pkcnt = 0 OR pktype = 'PKEY_INTERNAL' THEN\n                      -- internal def\n                      v_constraint_name := v_constraintrec.constraint_name;\n                      v_constraint_def  := v_constraintrec.constraint_definition;\n                      v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                        || 'CONSTRAINT' || ' '\n                        || v_constraint_name || ' '\n                        || v_constraint_def\n                        || ',' || E'\\n';\n                  ELSE\n                    -- Issue#16 handle external PG def\n                    SELECT 'ALTER TABLE ONLY ' || in_schema || '.' || c.relname || ' ADD CONSTRAINT ' || r.conname || ' ' || pg_catalog.pg_get_constraintdef(r.oid, true) || ';' INTO v_pkey_def\n                    FROM pg_catalog.pg_constraint r, pg_class c, pg_namespace n where r.conrelid = c.oid and  r.contype = 'p' and n.oid = r.connamespace and n.nspname = in_schema AND c.relname = in_table;\n                  END IF;\n                  IF bPartition THEN\n                    continue;\n                  END IF;\n              ELSIF v_constraintrec.type_rank = 3 THEN\n                  -- handle foreign key constraints\n                  --Issue#22 fix: added FKEY_NONE check\n                  IF fktype = 'FKEYS_NONE' THEN\n                      -- skip\n                      continue;\n                  ELSIF fkcnt = 0 OR fktype = 'FKEYS_INTERNAL' THEN\n                      -- internal def\n                      v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                        || 'CONSTRAINT' || ' '\n                        || v_constraint_name || ' '\n                        || v_constraint_def\n                        || ',' || E'\\n';\n                  ELSE\n                      -- external def\n                      SELECT 'ALTER TABLE ONLY ' || n.nspname || '.' || c2.relname || ' ADD CONSTRAINT ' || r.conname || ' ' || pg_catalog.pg_get_constraintdef(r.oid, true) || ';' INTO v_fkey_def\n                      FROM pg_constraint r, pg_class c1, pg_namespace n, pg_class c2 where r.conrelid = c1.oid and  r.contype = 'f' and n.nspname = in_schema and n.oid = r.connamespace and r.conrelid = c2.oid and c2.relname = in_table and\n                      r.conname = v_constraint_name and r.conparentid = 0;\n                      v_fkey_defs = v_fkey_defs || v_fkey_def || E'\\n';\n                  END IF;\n              ELSE\n                  -- handle all other constraints besides PKEY and FKEYS as internal defs by default\n                  v_table_ddl := v_table_ddl || '  ' -- note: two char spacer to start, to indent the column\n                    || 'CONSTRAINT' || ' '\n                    || v_constraint_name || ' '\n                    || v_constraint_def\n                    || ',' || E'\\n';\n              END IF;\n              if bVerbose THEN RAISE NOTICE 'DEBUG4: constraint name=% constraint_def=%', v_constraint_name,v_constraint_def; END IF;\n              constraintarr := constraintarr || v_constraintrec.constraint_name:: text;\n\n            END LOOP;\n          END IF;\n\n          -- drop the last comma before ending the create statement, which should be right before the carriage return character\n          -- Issue#24: make sure the comma is there before removing it\n          select substring(v_table_ddl, length(v_table_ddl) - 1, 1) INTO v_temp;\n          IF v_temp = ',' THEN\n              v_table_ddl = substr(v_table_ddl, 0, length(v_table_ddl) - 1) || E'\\n';\n          END IF;\n          IF bVerbose THEN RAISE NOTICE '(3)tabledef so far: %', trim(v_table_ddl); END IF;\n\n          -- ---------------------------------------------------------------------------\n          -- at this point we have everything up to the last table-enclosing parenthesis\n          -- ---------------------------------------------------------------------------\n          IF bVerbose THEN RAISE NOTICE '(4)tabledef so far: %', v_table_ddl; END IF;\n\n          -- See if this is an inheritance-based child table and finish up the table create.\n          IF bPartition and bInheritance THEN\n            -- Issue#11: handle parent schema\n            -- v_table_ddl := v_table_ddl || ') INHERITS (' || in_schema || '.' || v_parent || ') ' || E'\\n' || v_relopts || ' ' || v_tablespace || ';' || E'\\n';\n            IF v_parent_schema = '' OR v_parent_schema IS NULL THEN v_parent_schema = in_schema; END IF;\n            v_table_ddl := v_table_ddl || ') INHERITS (' || v_parent_schema || '.' || v_parent || ') ' || E'\\n' || v_relopts || ' ' || v_tablespace || ';' || E'\\n';\n          END IF;\n\n          IF v_pgversion >= 100000 AND NOT bPartition and NOT bInheritance THEN\n            -- See if this is a partitioned table (pg_class.relkind = 'p') and add the partitioned key\n            SELECT pg_get_partkeydef(c1.oid) as partition_key INTO v_partition_key FROM pg_class c1 JOIN pg_namespace n ON (n.oid = c1.relnamespace) LEFT JOIN pg_partitioned_table p ON (c1.oid = p.partrelid)\n            WHERE n.nspname = in_schema and n.oid = c1.relnamespace and c1.relname = in_table and c1.relkind = 'p';\n\n            IF v_partition_key IS NOT NULL AND v_partition_key <> '' THEN\n              -- add partition clause\n              -- NOTE:  cannot specify default tablespace for partitioned relations\n              -- v_table_ddl := v_table_ddl || ') PARTITION BY ' || v_partition_key || ' ' || v_tablespace || ';' || E'\\n';\n              v_table_ddl := v_table_ddl || ') PARTITION BY ' || v_partition_key || ';' || E'\\n';\n            ELSEIF v_relopts <> '' THEN\n              v_table_ddl := v_table_ddl || ') ' || v_relopts || ' ' || v_tablespace || ';' || E'\\n';\n            ELSE\n              -- end the create definition\n              v_table_ddl := v_table_ddl || ') ' || v_tablespace || ';' || E'\\n';\n            END IF;\n          END IF;\n\n          IF bVerbose THEN RAISE NOTICE '(5)tabledef so far: %', v_table_ddl; END IF;\n\n          -- Add closing paren for regular tables\n          -- IF NOT bPartition THEN\n          -- v_table_ddl := v_table_ddl || ') ' || v_relopts || ' ' || v_tablespace || E';\\n';\n          -- END IF;\n          -- RAISE NOTICE 'ddlsofar3: %', v_table_ddl;\n\n          -- Issue#16 create the external PKEY def if indicated\n          IF v_pkey_def <> '' THEN\n              v_table_ddl := v_table_ddl || v_pkey_def || E'\\n';\n          END IF;\n\n          -- Issue#20\n          IF v_fkey_defs <> '' THEN\n                v_table_ddl := v_table_ddl || v_fkey_defs || E'\\n';\n          END IF;\n\n          IF bVerbose THEN RAISE NOTICE '(6)tabledef so far: %', v_table_ddl; END IF;\n\n          -- create indexes\n          FOR v_indexrec IN\n            SELECT indexdef, COALESCE(tablespace, 'pg_default') as tablespace, indexname FROM pg_indexes WHERE (schemaname, tablename) = (in_schema, in_table)\n          LOOP\n            -- RAISE NOTICE 'DEBUG6: indexname=%  indexdef=%', v_indexrec.indexname, v_indexrec.indexdef;\n            -- loop through constraints and skip ones already defined\n            bSkip = False;\n            FOREACH constraintelement IN ARRAY constraintarr\n            LOOP\n              IF constraintelement = v_indexrec.indexname THEN\n                  -- RAISE NOTICE 'DEBUG7: skipping index, %', v_indexrec.indexname;\n                  bSkip = True;\n                  EXIT;\n              END IF;\n            END LOOP;\n            if bSkip THEN CONTINUE; END IF;\n\n            -- Add IF NOT EXISTS clause so partition index additions will not be created if declarative partition in effect and index already created on parent\n            v_indexrec.indexdef := REPLACE(v_indexrec.indexdef, 'CREATE INDEX', 'CREATE INDEX IF NOT EXISTS');\n            -- Fix Issue#26: do it for unique/primary key indexes as well\n            v_indexrec.indexdef := REPLACE(v_indexrec.indexdef, 'CREATE UNIQUE INDEX', 'CREATE UNIQUE INDEX IF NOT EXISTS');\n            -- RAISE NOTICE 'DEBUG8: adding index, %', v_indexrec.indexname;\n\n            -- NOTE:  cannot specify default tablespace for partitioned relations\n            IF v_partition_key IS NOT NULL AND v_partition_key <> '' THEN\n                v_table_ddl := v_table_ddl || v_indexrec.indexdef || ';' || E'\\n';\n            ELSE\n                -- Issue#25: see if partial index or not\n                select CASE WHEN i.indpred IS NOT NULL THEN True ELSE False END INTO v_partial\n                FROM pg_index i JOIN pg_class c1 ON (i.indexrelid = c1.oid) JOIN pg_class c2 ON (i.indrelid = c2.oid)\n                WHERE c1.relnamespace::regnamespace::text = in_schema AND c2.relnamespace::regnamespace::text = in_schema AND c2.relname = in_table AND c1.relname = v_indexrec.indexname;\n                IF v_partial THEN\n                    -- Put tablespace def before WHERE CLAUSE\n                    v_temp = v_indexrec.indexdef;\n                    v_pos = POSITION(' WHERE ' IN v_temp);\n                    v_temp2 = SUBSTRING(v_temp, v_pos);\n                    v_temp  = SUBSTRING(v_temp, 1, v_pos);\n                    v_table_ddl := v_table_ddl || v_temp || ' TABLESPACE ' || v_indexrec.tablespace || v_temp2 || ';' || E'\\n';\n                ELSE\n                    v_table_ddl := v_table_ddl || v_indexrec.indexdef || ' TABLESPACE ' || v_indexrec.tablespace || ';' || E'\\n';\n                END IF;\n            END IF;\n\n          END LOOP;\n          IF bVerbose THEN RAISE NOTICE '(7)tabledef so far: %', v_table_ddl; END IF;\n\n          -- Issue#20: added logic for table and column comments\n          IF  cmtcnt > 0 THEN\n              FOR v_rec IN\n                SELECT c.relname, 'COMMENT ON ' || CASE WHEN c.relkind in ('r','p') AND a.attname IS NULL THEN 'TABLE ' WHEN c.relkind in ('r','p') AND a.attname IS NOT NULL THEN 'COLUMN ' WHEN c.relkind = 'f' THEN 'FOREIGN TABLE '\n                      WHEN c.relkind = 'm' THEN 'MATERIALIZED VIEW ' WHEN c.relkind = 'v' THEN 'VIEW ' WHEN c.relkind = 'i' THEN 'INDEX ' WHEN c.relkind = 'S' THEN 'SEQUENCE ' ELSE 'XX' END || n.nspname || '.' ||\n                      CASE WHEN c.relkind in ('r','p') AND a.attname IS NOT NULL THEN quote_ident(c.relname) || '.' || a.attname ELSE quote_ident(c.relname) END || ' IS '   || quote_literal(d.description) || ';' as ddl\n                FROM pg_class c JOIN pg_namespace n ON (n.oid = c.relnamespace) LEFT JOIN pg_description d ON (c.oid = d.objoid) LEFT JOIN pg_attribute a ON (c.oid = a.attrelid AND a.attnum > 0 and a.attnum = d.objsubid)\n                WHERE d.description IS NOT NULL AND n.nspname = in_schema AND c.relname = in_table ORDER BY 2 desc, ddl\n              LOOP\n                  --RAISE NOTICE 'comments:%', v_rec.ddl;\n                  v_table_ddl = v_table_ddl || v_rec.ddl || E'\\n';\n              END LOOP;\n          END IF;\n          IF bVerbose THEN RAISE NOTICE '(8)tabledef so far: %', v_table_ddl; END IF;\n\n          IF trigtype = 'INCLUDE_TRIGGERS' THEN\n            -- Issue#14: handle multiple triggers for a table\n            FOR v_trigrec IN\n                select pg_get_triggerdef(t.oid, True) || ';' as triggerdef FROM pg_trigger t, pg_class c, pg_namespace n\n                WHERE n.nspname = in_schema and n.oid = c.relnamespace and c.relname = in_table and c.relkind = 'r' and t.tgrelid = c.oid and NOT t.tgisinternal\n            LOOP\n                v_table_ddl := v_table_ddl || v_trigrec.triggerdef;\n                v_table_ddl := v_table_ddl || E'\\n';\n                IF bVerbose THEN RAISE NOTICE 'triggerdef = %', v_trigrec.triggerdef; END IF;\n            END LOOP;\n          END IF;\n\n          IF bVerbose THEN RAISE NOTICE '(9)tabledef so far: %', v_table_ddl; END IF;\n          -- add empty line\n          v_table_ddl := v_table_ddl || E'\\n';\n          IF bVerbose THEN RAISE NOTICE '(10)tabledef so far: %', v_table_ddl; END IF;\n\n          -- reset search_path back to what it was\n          IF search_path_old = '' THEN\n            SELECT set_config('search_path', '', false) into v_temp;\n          ELSE\n            EXECUTE 'SET search_path = ' || search_path_old;\n          END IF;\n\n          RETURN v_table_ddl;\n\n          EXCEPTION\n          WHEN others THEN\n          BEGIN\n            GET STACKED DIAGNOSTICS v_diag1 = MESSAGE_TEXT, v_diag2 = PG_EXCEPTION_DETAIL, v_diag3 = PG_EXCEPTION_HINT, v_diag4 = RETURNED_SQLSTATE, v_diag5 = PG_CONTEXT, v_diag6 = PG_EXCEPTION_CONTEXT;\n            -- v_ret := 'line=' || v_diag6 || '. '|| v_diag4 || '. ' || v_diag1 || ' .' || v_diag2 || ' .' || v_diag3;\n            v_ret := 'line=' || v_diag6 || '. '|| v_diag4 || '. ' || v_diag1;\n            RAISE EXCEPTION '%', v_ret;\n            -- put additional coding here if necessarY\n            RETURN '';\n          END;\n\n        END;\n      $$;",{compress:!0,removeAll:!0});var r=function(e){return e.NO_ACTION="a",e.RESTRICT="r",e.CASCADE="c",e.SET_NULL="n",e.SET_DEFAULT="d",e}({})},9387:(e,n,t)=>{"use strict";t.d(n,{Z:()=>s}),t(80263);var a=t(53239);function s(e){let n=(0,a.useRef)();return(0,a.useEffect)(()=>{n.current=e}),n.current}t(54955),t(34531)},30287:(e,n,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/sql/[id]",function(){return t(62578)}])},37490:(e,n,t)=>{"use strict";t.d(n,{HJ:()=>o});var a=t(56947),s=t(15629),r=t(92403);let l=e=>{let{table:n,schema:t}=e,a=[];n&&a.push("tablename = '".concat(n,"'")),t&&a.push("schemaname = '".concat(t,"'"));let s=a.length>0?"WHERE ".concat(a.join(" AND ")):"";return"\n  \n  SELECT\n    tbl.schemaname,\n    tbl.tablename,\n    tbl.quoted_name,\n    tbl.is_table,\n    json_agg(a) as columns\n  FROM\n    (\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        true as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind = 'r'\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n      union all\n      SELECT\n        n.nspname as schemaname,\n        c.relname as tablename,\n        (quote_ident(n.nspname) || '.' || quote_ident(c.relname)) as quoted_name,\n        false as is_table\n      FROM\n        pg_catalog.pg_class c\n        JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n      WHERE\n        c.relkind in ('v', 'm')\n        AND n.nspname not in ('information_schema', 'pg_catalog', 'pg_toast')\n        AND n.nspname not like 'pg_temp_%'\n        AND n.nspname not like 'pg_toast_temp_%'\n        AND has_schema_privilege(n.oid, 'USAGE') = true\n        AND has_table_privilege(quote_ident(n.nspname) || '.' || quote_ident(c.relname), 'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER') = true\n    ) as tbl\n    LEFT JOIN (\n      SELECT\n        attrelid,\n        attname,\n        format_type(atttypid, atttypmod) as data_type,\n        attnum,\n        attisdropped\n      FROM\n        pg_attribute\n    ) as a ON (\n      a.attrelid = tbl.quoted_name::regclass\n      AND a.attnum > 0\n      AND NOT a.attisdropped\n      AND has_column_privilege(tbl.quoted_name, a.attname, 'SELECT, INSERT, UPDATE, REFERENCES')\n    )\n  ".concat(s,"\n  GROUP BY schemaname, tablename, quoted_name, is_table;\n").trim()};async function i(e,n){let{projectRef:t,connectionString:a,table:r,schema:i}=e,o=l({table:r,schema:i}),{result:c}=await (0,s.E)({projectRef:t,connectionString:a,sql:o,queryKey:["table-columns",i,r]},n);return c}let o=function(e){let{projectRef:n,connectionString:t,schema:s,table:l}=e,{enabled:o=!0,...c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.I)(r.c.tableColumns(n,s,l),e=>{let{signal:a}=e;return i({projectRef:n,connectionString:t,schema:s,table:l},a)},{enabled:o&&void 0!==n,...c})}},48684:(e,n,t)=>{"use strict";t.d(n,{A:()=>N});var a=t(80263),s=t(53239),r=t(53434),l=t.n(r),i=t(1801),o=t(75279),c=t(14986),d=t(28942),u=t(38777),m=t(97642),_=t(96293),p=t(49863),E=t(16698),h=t(1128),g=t(55219),f=t(82675),v=t(2359);let N=e=>{var n,t,r;let{data:N,yAxisKey:x,xAxisKey:b,format:y,customDateFormat:I=E.C_.FULL,title:T,highlightedValue:S,highlightedLabel:A,displayDateInUtc:C,minimalHeader:R,valuePrecision:L,className:O="",size:j="normal",emptyStateMessage:D,onBarClick:F,showLegend:w=!1,xAxisIsDate:k=!0,XAxisProps:H,YAxisProps:U,showGrid:P=!1,syncId:M}=e,{hoveredIndex:q,isHovered:G,isCurrentChart:W,setHover:K,clearHover:B}=(0,v.Z)("default"),{Container:Y}=(0,g.dQ)(j),[Q,z]=(0,s.useState)(null),V=(0,s.useMemo)(()=>N.map(e=>({...e,[x]:"string"==typeof e[x]?Number(e[x]):e[x]})),[N,x]),X=H||{interval:N.length-2,angle:0,tick:!1},J=U||{tickFormatter:e=>(0,g.Eg)(e,L),tick:!1,width:0},$=e=>C?l()(e).utc():l()(e),Z=function(){if(!k){var e;return Q?null==(e=N[Q])?void 0:e[b]:A}return null!==Q&&N&&void 0!==N[Q]&&$(N[Q][b]).format(I)||A}(),ee=null!==Q?null==(n=N[Q])?void 0:n[x]:S;return 0===N.length?(0,a.jsx)(f.A,{message:D,description:"It may take up to 24 hours for data to refresh",size:j,className:O,attribute:T,format:y}):(0,a.jsxs)("div",{className:["flex flex-col gap-y-3",O].join(" "),"data-sentry-component":"BarChart","data-sentry-source-file":"BarChart.tsx",children:[(0,a.jsx)(h._,{title:T,format:y,customDateFormat:I,highlightedValue:"number"==typeof ee?(0,g.Eg)(ee,L):ee,highlightedLabel:Z,minimalHeader:R,syncId:M,data:N,xAxisKey:b,yAxisKey:x,xAxisIsDate:k,displayDateInUtc:C,valuePrecision:L,attributes:[],"data-sentry-element":"ChartHeader","data-sentry-source-file":"BarChart.tsx"}),(0,a.jsx)(Y,{"data-sentry-element":"Container","data-sentry-source-file":"BarChart.tsx",children:(0,a.jsxs)(i.E,{data:V,className:"overflow-visible",onMouseMove:e=>{e.activeTooltipIndex!==Q&&z(e.activeTooltipIndex),K(e.activeTooltipIndex)},onMouseLeave:()=>{z(null),B()},onClick:e=>{var n,t;let a=null==e||null==(t=e.activePayload)||null==(n=t[0])?void 0:n.payload;F&&F(a,e)},"data-sentry-element":"RechartBarChart","data-sentry-source-file":"BarChart.tsx",children:[w&&(0,a.jsx)(o.s,{}),P&&(0,a.jsx)(c.d,{stroke:E.OK.AXIS}),(0,s.createElement)(d.h,{...J,axisLine:{stroke:E.OK.AXIS},tickLine:{stroke:E.OK.AXIS},key:x,"data-sentry-element":"YAxis","data-sentry-source-file":"BarChart.tsx"}),(0,s.createElement)(u.W,{...X,axisLine:{stroke:E.OK.AXIS},tickLine:{stroke:E.OK.AXIS},key:b,"data-sentry-element":"XAxis","data-sentry-source-file":"BarChart.tsx"}),(0,a.jsx)(m.m,{content:e=>{var n,t;return M&&G&&W&&null!==q?(0,a.jsxs)("div",{className:"bg-black/90 text-white p-2 rounded text-xs",children:[(0,a.jsx)("div",{className:"font-medium",children:l()(null==(n=N[q])?void 0:n[b]).format(I)}),(0,a.jsxs)("div",{children:[(0,g.Eg)(Number(null==(t=N[q])?void 0:t[x])||0,L),"string"==typeof y?y:""]})]}):null},"data-sentry-element":"Tooltip","data-sentry-source-file":"BarChart.tsx"}),(0,a.jsx)(_.y,{dataKey:x,fill:E.OK.GREEN_1,animationDuration:300,maxBarSize:48,"data-sentry-element":"Bar","data-sentry-source-file":"BarChart.tsx",children:null==N?void 0:N.map((e,n)=>(0,a.jsx)(p.f,{className:"transition-all duration-300 ".concat(F?"cursor-pointer":""),fill:Q===n||null===Q?E.OK.GREEN_1:E.OK.GREEN_2,enableBackground:12},"cell-".concat(n)))})]})}),N&&(0,a.jsxs)("div",{className:"text-foreground-lighter -mt-9 flex items-center justify-between text-xs",children:[(0,a.jsx)("span",{children:k?$(N[0][b]).format(I):N[0][b]}),(0,a.jsx)("span",{children:k?$(null==(t=N[(null==N?void 0:N.length)-1])?void 0:t[b]).format(I):null==(r=N[(null==N?void 0:N.length)-1])?void 0:r[b]})]})]})}},54273:(e,n,t)=>{"use strict";t.d(n,{b:()=>g});var a=t(80263),s=t(95137),r=t.n(s),l=t(67201),i=t(72259),o=t(29277),c=t(77406),d=t(77191),u=t.n(d),m=t(53239),_=t(73969),p=t(52647),E=t(71139),h=t(40022);let g=e=>{let{iconOnly:n=!1,type:t="default",text:s="Export",align:d="start",results:g,fileName:f,onDownloadAsCSV:v,onCopyAsMarkdown:N,onCopyAsJSON:x}=e,b=g.map(e=>{let n={...e};return Object.keys(e).forEach(t=>{"object"==typeof e[t]&&(n[t]=JSON.stringify(e[t]))}),n}),y=(0,m.useMemo)(()=>{if(g){let e=Array.from(g)[0];if(e)return Object.keys(e)}},[g]),I=()=>{let e=new Blob([u().unparse(b,{columns:y})],{type:"text/csv;charset=utf-8;"});r()(e,"".concat(f,".csv")),_.oR.success("Downloading results as CSV"),null==v||v()};return(0,a.jsxs)(E.rI,{"data-sentry-element":"DropdownMenu","data-sentry-component":"DownloadResultsButton","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(E.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"DownloadResultsButton.tsx",children:(0,a.jsx)(h.$,{type:t,icon:n?(0,a.jsx)(l.A,{}):void 0,iconRight:n?void 0:(0,a.jsx)(i.A,{}),disabled:0===g.length,className:n?"w-7":"","data-sentry-element":"Button","data-sentry-source-file":"DownloadResultsButton.tsx",children:!n&&s})}),(0,a.jsxs)(E.SQ,{align:d,className:"w-44","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsxs)(E._2,{className:"gap-x-2",onClick:()=>I(),"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(l.A,{size:14,"data-sentry-element":"Download","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,a.jsx)("p",{children:"Download CSV"})]}),(0,a.jsxs)(E._2,{onClick:()=>{if(navigator){0==b.length&&(0,_.oR)("Results are empty");let e=Object.keys(b[0]),n=b.map(n=>{let t=[];return e.forEach(e=>t.push(n[e])),t}),t=[e].concat(n),a=(0,c.Q)(t);(0,p.l)(a,()=>{_.oR.success("Copied results to clipboard"),null==N||N()})}},className:"gap-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(o.A,{size:14,"data-sentry-element":"Clipboard","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,a.jsx)("p",{children:"Copy as markdown"})]}),(0,a.jsxs)(E._2,{onClick:()=>{if(navigator){if(0===g.length)return(0,_.oR)("Results are empty");(0,p.l)(JSON.stringify(g,null,2),()=>{_.oR.success("Copied results to clipboard"),null==x||x()})}},className:"gap-x-2","data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"DownloadResultsButton.tsx",children:[(0,a.jsx)(o.A,{size:14,"data-sentry-element":"Clipboard","data-sentry-source-file":"DownloadResultsButton.tsx"}),(0,a.jsx)("p",{children:"Copy as JSON"})]})]})]})}},55219:(e,n,t)=>{"use strict";t.d(n,{BY:()=>p,Eg:()=>c,XO:()=>u,bk:()=>m,dQ:()=>_});var a=t(80263),s=t(53434),r=t.n(s),l=t(53239),i=t(65768),o=t(16698);let c=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return d(e)?u(e,n):e.toLocaleString()},d=e=>String(e).includes("."),u=(e,n)=>{if(0===n)return String(Math.round(e));if(!d(e))return e.toLocaleString()+"."+"0".repeat(n);{let[t,a]=String(e).split(".");return Number(t).toLocaleString()+"."+a.slice(0,n)}},m=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.C_.FULL,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t?r().utc(e).format(n):r()(e).format(n)},_=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{tiny:76,small:96,normal:160,large:280},t=n[e];return{Container:(0,l.useMemo)(()=>e=>{let{className:n,children:s}=e;return(0,a.jsx)(i.u,{className:n,height:t,minHeight:t,width:"100%",children:s})},[e]),minHeight:t}},p=e=>{let{data:n,xAxisKey:t,yAxisKey:a,stackKey:s,variant:r="values"}=e,i=(0,l.useMemo)(()=>n?Object.entries(n.reduce((e,n)=>{let r=n[t],l=n[a],i=n[s];return e[r]||(e[r]={}),e[r][i]=l,e},{})).map(e=>{let[n,a]=e;return{...a,[t]:Number.isNaN(Number(n))?n:Number(n)}}):[],[JSON.stringify(n)]),o=(0,l.useMemo)(()=>Object.keys(i[0]||{}).filter(e=>e!==t&&e!==a).sort(),[JSON.stringify(i[0]||{})]),c=(0,l.useMemo)(()=>{if("percentages"===r)return i.map(e=>{let n=Object.entries(e),t=n.filter(e=>{let[n,t]=e;return o.includes(n)}).reduce((e,n)=>{let[t,a]=n;return e+a},0);return n.reduce((e,n)=>{let[a,s]=n;return o.includes(a)?{...e,[a]:0!==s?s/t:0}:{...e,[a]:s}},{})})},[JSON.stringify(i)]);return{dataKeys:o,stackedData:i,percentagesStackedData:c}}},60420:(e,n,t)=>{"use strict";t.d(n,{C:()=>r});var a=t(80263),s=t(51500);let r=e=>{let{children:n,className:t}=e;return(0,a.jsx)("div",{"aria-label":"Table grid footer",className:(0,s.cn)("flex min-h-9 h-9 overflow-hidden overflow-x-auto items-center px-2 w-full border-t",t),"data-sentry-component":"GridFooter","data-sentry-source-file":"GridFooter.tsx",children:n})}},62578:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>ns});var a=t(80263),s=t(24400),r=t(53239),l=t(73347),i=t(32144),o=t(28881),c=t(11462),d=t(49434),u=t.n(d),m=t(73969),_=t(75232),p=t(7022),E=t(60420),h=t(9483),g=t(56947),f=t(15629),v=t(5013),N=t(92403);let x=e=>{let{schemas:n,limit:t=100}=e;return"\n".concat(v.n,"\n\nwith records as (\n  select\n    c.oid::int8 as \"id\",\n    case c.relkind\n      when 'r' then pg_temp.pg_get_tabledef(\n        concat(nc.nspname),\n        concat(c.relname),\n        false,\n        'FKEYS_INTERNAL',\n        'NO_TRIGGERS'\n      )\n      when 'v' then concat(\n        'create view ', concat(nc.nspname, '.', c.relname), ' as',\n        pg_get_viewdef(concat(nc.nspname, '.', c.relname), true)\n      )\n      when 'm' then concat(\n        'create materialized view ', concat(nc.nspname, '.', c.relname), ' as',\n        pg_get_viewdef(concat(nc.nspname, '.', c.relname), true)\n      )\n      when 'f' then concat('create foreign table ', nc.nspname, '.', c.relname, ' ( ... )')\n      when 'p' then pg_temp.pg_get_tabledef(\n        concat(nc.nspname),\n        concat(c.relname),\n        false,\n        'FKEYS_INTERNAL',\n        'NO_TRIGGERS'\n      )\n    end as \"sql\"\n  from\n    pg_namespace nc\n    join pg_class c on nc.oid = c.relnamespace\n  where\n    c.relkind in ('r', 'v', 'm', 'f', 'p')\n    and not pg_is_other_temp_schema(nc.oid)\n    and (\n      pg_has_role(c.relowner, 'USAGE')\n      or has_table_privilege(\n        c.oid,\n        'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER'\n      )\n      or has_any_column_privilege(c.oid, 'SELECT, INSERT, UPDATE, REFERENCES')\n    )\n    and nc.nspname IN (").concat(n.map(e=>"'".concat(e,"'")).join(", "),")\n  order by c.relname asc\n  limit ").concat(t,"\n  offset 0\n)\nselect\n  jsonb_build_object(\n    'definitions', coalesce(jsonb_agg(\n      jsonb_build_object(\n        'id', r.id,\n        'sql', r.sql\n      )\n    ), '[]'::jsonb)\n  ) \"data\"\nfrom records r;\n  ").trim()};async function b(e,n){let{projectRef:t,connectionString:a,schemas:s,limit:r}=e,l=x({schemas:s,limit:r}),{result:i}=await (0,f.E)({projectRef:t,connectionString:a,sql:l,queryKey:["entity-definitions",s]},n);return i[0].data.definitions}let y=function(e){let{projectRef:n,connectionString:t,schemas:a,limit:s}=e,{enabled:r=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,g.I)(N.c.entityDefinitions(n,a),e=>{let{signal:r}=e;return b({projectRef:n,connectionString:t,schemas:a,limit:s},r)},{enabled:r&&void 0!==n&&a.length>0,...l})};var I=t(65172),T=t(56131),S=t(6772),A=t(78720),C=t(57132),R=t(15961),L=t(65303),O=t(23385),j=t(5483),D=t(63492),F=t(34487),w=t(34531),k=t(33986),H=t(667),U=t(86815),P=t(54474),M=t(66628),q=t(12046),G=t(55555),W=t(65841),K=t(51500),B=t(30435),Y=t(71139),Q=t(40022),z=t(58170),V=t(77635),X=t(50204);let J=e=>{let{visible:n,hasDestructiveOperations:t,hasUpdateWithoutWhere:s,onCancel:r,onConfirm:l}=e;return(0,a.jsxs)(X.A,{visible:n,size:"large",title:"Potential issue".concat(t&&s?"s":""," detected with your query"),confirmLabel:"Run this query",variant:"warning",alert:{base:{variant:"warning"},title:t&&s?"The following potential issues have been detected:":"The following potential issue has been detected:",description:"Ensure that these are intentional before executing this query"},onCancel:r,onConfirm:l,"data-sentry-element":"ConfirmationModal","data-sentry-component":"RunQueryWarningModal","data-sentry-source-file":"RunQueryWarningModal.tsx",children:[(0,a.jsx)("div",{className:"text-sm",children:(0,a.jsxs)("ul",{className:"border rounded-md grid bg-surface-200",children:[t&&(0,a.jsxs)("li",{className:"grid pt-3 pb-2 px-4",children:[(0,a.jsx)("span",{className:"font-bold",children:"Query has destructive operation"}),(0,a.jsx)("span",{className:"text-foreground-lighter",children:"Make sure you are not accidentally removing something important."})]}),t&&s&&(0,a.jsx)(V.w,{}),s&&(0,a.jsxs)("li",{className:"grid pt-2 pb-3 px-4 gap-1",children:[(0,a.jsx)("span",{className:"font-bold",children:"Query uses update without a where clause"}),(0,a.jsxs)("span",{className:"text-foreground-lighter",children:["Without a ",(0,a.jsx)("code",{className:"text-xs",children:"where"})," clause, this could update all rows in the table."]})]})]})}),(0,a.jsx)("p",{className:"mt-4 text-sm text-foreground-light",children:"Please confirm that you would like to execute this query."})]})};var $=t(32248),Z=t(63748),ee=t(79512),en=t(78151);function et(e){return e.replace(/^\"/,"").replace(/\"$/,"").replace(/\"\"/,'"')}function ea(e){return e!=e.toLowerCase()?'"'.concat(e,'"'):e}var es=t(92303);let er=()=>"\nSELECT word FROM pg_get_keywords();\n".trim();async function el(e,n){let{projectRef:t,connectionString:a}=e,s=er(),{result:r}=await (0,f.E)({projectRef:t,connectionString:a,sql:s,queryKey:["keywords"]},n);return r.map(e=>e.word.toLocaleLowerCase())}let ei=function(e){let{projectRef:n,connectionString:t}=e,{enabled:a=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,g.I)(N.c.keywords(n),e=>{let{signal:a}=e;return el({projectRef:n,connectionString:t},a)},{enabled:a&&void 0!==n,...s})};var eo=t(63604),ec=t(37490);let ed=(e,n)=>{let{data:t}=(0,j.YA)(),a=(0,q.aP)(),[s]=(0,L.U)(_.rS.SQL_EDITOR_INTELLISENSE,!0),{data:l,isSuccess:i}=ei({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString},{enabled:s}),{data:o,isSuccess:c}=(0,es.e)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString},{enabled:s}),{data:d,isSuccess:u}=(0,eo.w$)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString},{enabled:s}),{data:m,isSuccess:p}=(0,ec.HJ)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString},{enabled:s}),E=(0,r.useRef)(null),h=s&&p&&u&&i&&c;h&&(null===E.current&&(E.current={}),E.current.tableColumns=m,E.current.schemas=d,E.current.keywords=l,E.current.functions=o),(0,r.useEffect)(()=>{if(n){let t=n.languages.registerDocumentFormattingEditProvider("pgsql",{async provideDocumentFormattingEdits(n){let t=n.getValue(),s=(0,F.A)(t);return e&&a.setSql(e,s),[{range:n.getFullModelRange(),text:s}]}});return()=>t.dispose()}},[n]),(0,r.useEffect)(()=>{let e=null,t=null;h&&n&&h&&(e=n.languages.registerCompletionItemProvider("pgsql",function(e,n){return{triggerCharacters:[" ",".",'"'],provideCompletionItems:function(t,a,s){try{let o=new en.A(t,a.column-2,a.lineNumber-1);if('"'===s.triggerCharacter){var r=e,l=n,i=o;let t=[];if(!i.isFowardDQuote())return{suggestions:t};if(i.next(),i.isNextPeriod()){let e=i.readIdent(),n=!1;e.match(/^\".*?\"$/)&&(n=!0,e=et(e));let a=l.current.tableColumns.find(t=>n&&t.tablename===e||!n&&t.tablename.toLocaleLowerCase()==e.toLocaleLowerCase());if(!a)return{suggestions:t};a.columns.forEach(e=>{t.push({label:e.attname,kind:r.languages.CompletionItemKind.Property,detail:e.data_type,insertText:e.attname})})}else l.current.tableColumns.forEach(e=>{t.push({label:e.tablename,kind:r.languages.CompletionItemKind.Class,insertText:e.tablename})});return{suggestions:t}}if("."===s.triggerCharacter)return function(e,n,t){var a,s;let r=[],l=(a=t,s=3,a.readIdents(3).map(e=>{let n=!1;return e.match(/^\".*?\"$/)&&(n=!0,e=et(e)),{isQuoted:n,name:e}})),i=0,o=n.current.schemas.find(e=>{var n,t;let a=l&&l.length>i?l[i]:{};return a.isQuoted&&e.name===a.name||!a.isQuoted&&(null==(n=e.name)?void 0:n.toLocaleLowerCase())==(null==(t=a.name)?void 0:t.toLocaleLowerCase())});if(o?i++:o=n.current.schemas.find(e=>"public"==e.name),l.length==i)return n.current.tableColumns.forEach(n=>{n.schemaname==o.name&&r.push({label:n.tablename,kind:e.languages.CompletionItemKind.Class,detail:"public"!==n.schemaname?n.schemaname:null,insertText:ea(n.tablename)})}),{suggestions:r};let c=n.current.tableColumns.find(e=>{var n,t;let a=l&&l.length>i?l[i]:{};return e.schemaname==o.name&&a.isQuoted&&e.tablename===a.name||!a.isQuoted&&(null==(n=e.tablename)?void 0:n.toLocaleLowerCase())==(null==(t=a.name)?void 0:t.toLocaleLowerCase())});return c&&c.columns.forEach(n=>{r.push({label:n.attname,kind:e.languages.CompletionItemKind.Property,detail:n.data_type,insertText:ea(n.attname)})}),{suggestions:r}}(e,n,o);return function(e,n){var t,a,s,r;let l=[];return(null==(t=n.current.keywords)?void 0:t.length)>0&&n.current.keywords.forEach(n=>{l.push({label:n,kind:e.languages.CompletionItemKind.Keyword,insertText:n})}),(null==(a=n.current.schemas)?void 0:a.length)>0&&n.current.schemas.forEach(n=>{l.push({label:n.name,kind:e.languages.CompletionItemKind.Keyword,insertText:n.name})}),(null==(s=n.current.tableColumns)?void 0:s.length)>0&&n.current.tableColumns.forEach(n=>{let t="public"==n.schemaname?n.tablename:n.schemaname+"."+n.tablename;l.push({label:n.tablename,detail:"public"!==n.schemaname?n.schemaname:null,kind:n.is_table?e.languages.CompletionItemKind.Class:e.languages.CompletionItemKind.Interface,insertText:ea(t)}),n.columns.forEach(t=>{if(!t)return;let a=l.find(n=>n.label===(null==t?void 0:t.attname)&&n.kind===e.languages.CompletionItemKind.Field&&n.detail===(null==t?void 0:t.data_type));a?(a.tables.push(n.tablename),a.tables.sort(),a.documentation=a.tables.join(", ")):l.push({label:t.attname,kind:e.languages.CompletionItemKind.Field,detail:t.data_type,documentation:n.tablename,tables:[n.tablename],insertText:ea(t.attname)})})}),(null==(r=n.current.functions)?void 0:r.length)>0&&n.current.functions.forEach(n=>{l.push({label:n.name,kind:e.languages.CompletionItemKind.Function,detail:n.return_type,insertText:n.name})}),{suggestions:l}}(e,n)}catch(e){return{suggestions:[]}}}}}(n,E)),t=n.languages.registerSignatureHelpProvider("pgsql",{signatureHelpTriggerCharacters:["(",","],provideSignatureHelp:function(e,n){let t=new en.A(e,n.column-2,n.lineNumber-1),a=t.readArguments();if(a<0)return null;let s=t.readIdent();if(!s||s.match(/^\".*?\"$/))return null;let r=E.current.functions.find(e=>e.name.toLocaleLowerCase()===s.toLocaleLowerCase());if(!r||!r.args||r.args.length<a)return null;let l=Math.min(a,r.args.length-1),i=[];return i.push({label:"".concat(r.name,"(").concat(r.argument_types,")"),parameters:r.args.map(e=>({label:e.name}))}),{value:{signatures:i,activeSignature:0,activeParameter:l},dispose:()=>{}}}}));return()=>{null==e||e.dispose(),null==t||t.dispose()}},[h,n])};var eu=t(54273),em=t(64722),e_=t(80586),ep=t(53434),eE=t.n(ep),eh=t(41255),eg=t(25643),ef=t(88602),ev=t(48684),eN=t(82675),ex=t(15601),eb=t.n(ex),ey=t(2119),eI=t(19428),eT=t(40990),eS=t(74245),eA=t(47142);let eC=(e,n)=>{var t;return(null==e||null==(t=e.rows)?void 0:t.length)?e.rows.reduce((e,t)=>{let a=e[e.length-1]||{};return[...e,{...t,[n.yKey]:(a[n.yKey]||0)+t[n.yKey]}]},[]):[]},eR=["number","string","date"],eL=e=>{let{results:n={rows:[]},config:t,onConfigChange:s}=e,{ref:l}=(0,_.g)(),[i,o]=(0,L.U)(_.rS.SQL_EDITOR_SQL_BLOCK_ACKNOWLEDGED(l),!1),c=(0,r.useMemo)(()=>Object.keys(n.rows[0]||{}).filter(e=>{let t=typeof n.rows[0][e];return eR.includes(t)}),[n]),d=(0,r.useMemo)(()=>n.rows[0]?Object.keys(n.rows[0]).filter(e=>{let t=n.rows[0][e];return"number"==typeof t||!isNaN(Number(t))}):[],[n]),u=t.xKey&&t.yKey,m=(0,r.useMemo)(()=>{var e,a;if(!u)return!1;let s=typeof(null==(e=n.rows[0])?void 0:e[t.xKey]),r=typeof(null==(a=n.rows[0])?void 0:a[t.yKey]);return"number"===s&&"number"===r},[u,n.rows,t.xKey,t.yKey]),p=(0,r.useMemo)(()=>eC(n,t),[n,t]),E=t.cumulative?p:n.rows,h=(e=>{var n;let t=(null==E||null==(n=E[0])?void 0:n[e])||"";return"number"==typeof t?"number":eE()(t).isValid()?"date":"string"})(t.xKey);return c.length?(0,a.jsxs)(W.HK,{direction:"horizontal",className:"flex-grow h-full","data-sentry-element":"ResizablePanelGroup","data-sentry-component":"ChartConfig","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(W.wV,{className:"p-4 h-full",defaultSize:75,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"ChartConfig.tsx",children:u?"bar"===t.type?(0,a.jsx)(ev.A,{showLegend:!0,size:"normal",xAxisIsDate:"date"===h,data:E,xAxisKey:t.xKey,yAxisKey:t.yKey,showGrid:t.showGrid,XAxisProps:{angle:0,interval:"preserveStart",hide:!t.showLabels,tickFormatter:e=>{let n=E[+e][t.xKey];return"date"===h?eE()(n).format("MMM D YYYY HH:mm"):n}},YAxisProps:{tickFormatter:e=>e.toLocaleString(),hide:!t.showLabels,domain:[0,"dataMax"]}}):null:(0,a.jsx)(W.wV,{className:"p-4 h-full",defaultSize:75,children:(0,a.jsx)(eN.A,{size:"normal",title:"Configure your chart",description:"Select your X and Y axis in the chart options panel"})})}),(0,a.jsx)(W.WM,{withHandle:!0,"data-sentry-element":"ResizableHandle","data-sentry-source-file":"ChartConfig.tsx"}),(0,a.jsxs)(W.wV,{defaultSize:25,minSize:15,className:"px-3 py-3 space-y-4 !overflow-y-auto","data-sentry-element":"ResizablePanel","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center h-5",children:[(0,a.jsx)("h2",{className:"text-sm text-foreground-lighter",children:"Chart options"}),t.xKey&&t.yKey&&(0,a.jsx)(ef.G,{type:"text",size:"tiny",onClick:()=>{let e=t.xKey,n=t.yKey;s({...t,xKey:n,yKey:e})},disabled:!m,icon:(0,a.jsx)(eh.A,{size:"15",className:"text-foreground-lighter"}),tooltip:{content:{side:"bottom",className:"w-64 text-center",text:m?"Swap X and Y axis":"Unable to swap X and Y axis - both axes need to numerical values"}},children:"Flip"})]}),!i&&(0,a.jsxs)(eA.Z,{showIcon:!1,type:"tip",className:"p-2 relative group",children:[(0,a.jsxs)(B.m_,{children:[(0,a.jsx)(B.k$,{onClick:()=>o(!0),className:"absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)(eg.A,{size:14,className:"text-foreground-light"})}),(0,a.jsx)(B.ZI,{side:"bottom",children:"Dismiss"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(ey.E,{variant:"success",className:"text-xs rounded px-1",children:"NEW"}),(0,a.jsx)("p",{className:"text-xs",children:"Add this chart to custom reports"})]}),(0,a.jsx)("p",{className:"text-xs text-foreground-light mt-1",children:"SQL snippets can now be added and saved to your custom reports. Try it out now!"}),(0,a.jsx)(Q.$,{asChild:!0,size:"tiny",type:"default",className:"mt-2",children:(0,a.jsx)(eb(),{href:"/project/".concat(l,"/reports"),children:"Head to Reports"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eI.J,{className:"text-xs text-foreground-light","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:"X Axis"}),(0,a.jsxs)(eT.l6,{value:t.xKey,onValueChange:e=>{s({...t,xKey:e})},"data-sentry-element":"Select_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(eT.bq,{"data-sentry-element":"SelectTrigger_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:t.xKey||"Select X Axis"}),(0,a.jsx)(eT.gC,{"data-sentry-element":"SelectContent_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:(0,a.jsx)(eT.s3,{"data-sentry-element":"SelectGroup_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:c.map(e=>(0,a.jsx)(eT.eb,{value:e,children:e},e))})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eI.J,{className:"text-xs text-foreground-light","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:"Y Axis"}),(0,a.jsxs)(eT.l6,{value:t.yKey,onValueChange:e=>{s({...t,yKey:e})},"data-sentry-element":"Select_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(eT.bq,{"data-sentry-element":"SelectTrigger_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:t.yKey||"Select Y Axis"}),(0,a.jsx)(eT.gC,{"data-sentry-element":"SelectContent_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:(0,a.jsx)(eT.s3,{"data-sentry-element":"SelectGroup_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:d.map(e=>(0,a.jsx)(eT.eb,{value:e,children:e},e))})})]})]}),(0,a.jsxs)("div",{className:"*:flex *:gap-2 *:items-center grid gap-2 *:text-foreground-light *:p-1.5 *:pl-0",children:[(0,a.jsxs)(eI.J,{className:"",htmlFor:"cumulative","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(eS.S,{id:"cumulative",name:"cumulative",checked:t.cumulative,onClick:()=>s({...t,cumulative:!t.cumulative}),"data-sentry-element":"Checkbox_Shadcn_","data-sentry-source-file":"ChartConfig.tsx"}),"Cumulative"]}),(0,a.jsxs)(eI.J,{htmlFor:"showLabels","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(eS.S,{id:"showLabels",name:"showLabels",checked:t.showLabels,onClick:()=>s({...t,showLabels:!t.showLabels}),"data-sentry-element":"Checkbox_Shadcn_","data-sentry-source-file":"ChartConfig.tsx"}),"Show labels"]}),(0,a.jsxs)(eI.J,{htmlFor:"showGrid","data-sentry-element":"Label_Shadcn_","data-sentry-source-file":"ChartConfig.tsx",children:[(0,a.jsx)(eS.S,{id:"showGrid",name:"showGrid",checked:t.showGrid,onClick:()=>s({...t,showGrid:!t.showGrid}),"data-sentry-element":"Checkbox_Shadcn_","data-sentry-source-file":"ChartConfig.tsx"}),"Show grid"]})]})]})]}):(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(eN.A,{size:"normal",description:"Execute a query and configure the chart options."})})};var eO=t(26587),ej=t(83940),eD=t(80903),eF=t(67867),ew=t(26008),ek=t(45957),eH=t(16265),eU=t(37225),eP=t(14786),eM=t(87610),eq=t(9387);let eG=e=>{let{id:n}=e,{profile:t}=(0,k.xc)(),s=(0,q.aP)().snippets[n],r=(null==t?void 0:t.id)===(null==s?void 0:s.snippet.owner_id);return(0,a.jsx)(a.Fragment,{children:r?null:(0,a.jsx)(ey.E,{children:"Read-only"})})},eW=e=>{let{id:n}=e,{profile:t}=(0,k.xc)(),s=(0,q.aP)(),l=s.savingStates[n],i=(0,eq.Z)(l),[c,d]=(0,r.useState)(!1),u=s.snippets[n],m=(null==t?void 0:t.id)===(null==u?void 0:u.snippet.owner_id);return(0,r.useEffect)(()=>{let e=!1;return"UPDATING"===i&&"IDLE"===l&&(d(!0),setTimeout(()=>{e||d(!1)},5e3)),()=>{e=!0}},[l]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"mx-2 flex items-center gap-2",children:[m&&"UPDATING_FAILED"===l&&(0,a.jsx)(Q.$,{type:"text",size:"tiny",icon:(0,a.jsx)(eP.A,{className:"text-gray-1100",strokeWidth:2}),onClick:()=>s.addNeedsSaving(n),children:"Retry"}),c?(0,a.jsxs)(B.m_,{children:[(0,a.jsx)(B.k$,{children:(0,a.jsx)(eD.A,{className:"text-brand",size:14,strokeWidth:3})}),(0,a.jsx)(B.ZI,{side:"bottom",children:"All changes saved"})]}):"UPDATING"===l?(0,a.jsxs)(B.m_,{children:[(0,a.jsx)(B.k$,{children:(0,a.jsx)(o.A,{className:"animate-spin",size:14,strokeWidth:2})}),(0,a.jsx)(B.ZI,{children:"Saving changes..."})]}):"UPDATING_FAILED"===l?m?(0,a.jsxs)(B.m_,{children:[(0,a.jsx)(B.k$,{children:(0,a.jsx)(eM.A,{className:"text-red-900",size:14,strokeWidth:2})}),(0,a.jsx)(B.ZI,{children:"Failed to save changes"})]}):(0,a.jsx)(eG,{id:n}):null]})})},eK=e=>{let{id:n,isExecuting:t=!1,isDisabled:s=!1,hasSelection:r=!1,prettifyQuery:l,executeQuery:i}=e,{ref:o}=(0,_.g)(),c=(0,q.aP)(),[d]=(0,L.U)(_.rS.SQL_EDITOR_AI_OPEN,!0),[u,p]=(0,L.U)(_.rS.SQL_EDITOR_INTELLISENSE,!0),[E,h]=(0,L.U)(_.rS.SQL_EDITOR_LAST_SELECTED_DB(o),""),g=c.snippets[n],f=void 0!==g&&g.snippet.favorite,v=()=>{p(!u),m.oR.success("Successfully ".concat(u?"disabled":"enabled"," intellisense. ").concat(u?"Please refresh your browser for changes to take place.":""))},N=()=>c.addFavorite(n),x=()=>c.removeFavorite(n);return(0,a.jsxs)("div",{className:"inline-flex items-center justify-end gap-x-2","data-sentry-component":"UtilityActions","data-sentry-source-file":"UtilityActions.tsx",children:[D.pe&&(0,a.jsx)(eW,{id:n}),(0,a.jsxs)(Y.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(Y.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsx)(Q.$,{"data-testid":"sql-editor-utility-actions",type:"default",className:(0,K.cn)("px-1",d?"block 2xl:hidden":"hidden"),icon:(0,a.jsx)(eO.A,{className:"text-foreground-light"}),"data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx"})}),(0,a.jsxs)(Y.SQ,{className:"w-48","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsxs)(Y._2,{className:"justify-between",onClick:v,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsxs)("span",{className:"flex items-center gap-x-2",children:[(0,a.jsx)(ej.A,{size:14,className:"text-foreground-light","data-sentry-element":"Keyboard","data-sentry-source-file":"UtilityActions.tsx"}),"Intellisense enabled"]}),u&&(0,a.jsx)(eD.A,{className:"text-brand",size:16})]}),(0,a.jsx)(Y.mB,{"data-sentry-element":"DropdownMenuSeparator","data-sentry-source-file":"UtilityActions.tsx"}),(0,a.jsxs)(Y._2,{className:"gap-x-2",onClick:()=>{f?x():N()},"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(eF.A,{size:14,strokeWidth:2,className:f?"fill-brand stroke-none":"fill-none stroke-foreground-light","data-sentry-element":"Heart","data-sentry-source-file":"UtilityActions.tsx"}),f?"Remove from":"Add to"," favorites"]}),(0,a.jsxs)(Y._2,{className:"gap-x-2",onClick:l,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(ew.A,{size:14,strokeWidth:2,className:"text-foreground-light","data-sentry-element":"AlignLeft","data-sentry-source-file":"UtilityActions.tsx"}),"Prettify SQL"]})]})]}),(0,a.jsxs)("div",{className:(0,K.cn)("items-center gap-x-2",d?"hidden 2xl:flex":"flex"),children:[(0,a.jsxs)(Y.rI,{"data-sentry-element":"DropdownMenu","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(Y.ty,{asChild:!0,"data-sentry-element":"DropdownMenuTrigger","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsx)(Q.$,{type:"text",className:"px-1",icon:(0,a.jsx)(ej.A,{className:"text-foreground-light"}),"data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx"})}),(0,a.jsx)(Y.SQ,{className:"w-48","data-sentry-element":"DropdownMenuContent","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsxs)(Y._2,{className:"justify-between",onClick:v,"data-sentry-element":"DropdownMenuItem","data-sentry-source-file":"UtilityActions.tsx",children:["Intellisense enabled",u&&(0,a.jsx)(eD.A,{className:"text-brand",size:16})]})})]}),D.pe&&(0,a.jsxs)(B.m_,{children:[(0,a.jsx)(B.k$,{asChild:!0,children:f?(0,a.jsx)(Q.$,{type:"text",size:"tiny",onClick:x,className:"px-1",icon:(0,a.jsx)(eF.A,{className:"fill-brand stroke-none"})}):(0,a.jsx)(Q.$,{type:"text",size:"tiny",onClick:N,className:"px-1",icon:(0,a.jsx)(eF.A,{className:"fill-none stroke-foreground-light"})})}),(0,a.jsxs)(B.ZI,{side:"bottom",children:[f?"Remove from":"Add to"," favorites"]})]}),(0,a.jsxs)(B.m_,{"data-sentry-element":"Tooltip","data-sentry-source-file":"UtilityActions.tsx",children:[(0,a.jsx)(B.k$,{asChild:!0,"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"UtilityActions.tsx",children:(0,a.jsx)(Q.$,{type:"text",onClick:l,className:"px-1",icon:(0,a.jsx)(ew.A,{strokeWidth:2,className:"text-foreground-light"}),"data-sentry-element":"Button","data-sentry-source-file":"UtilityActions.tsx"})}),(0,a.jsx)(B.ZI,{side:"bottom","data-sentry-element":"TooltipContent","data-sentry-source-file":"UtilityActions.tsx",children:"Prettify SQL"})]})]}),(0,a.jsx)("div",{className:"flex items-center justify-between gap-x-2",children:(0,a.jsxs)("div",{className:"flex items-center",children:[D.pe&&(0,a.jsx)(eH.A,{selectedDatabaseId:0===E.length?void 0:E,variant:"connected-on-right",onSelectId:e=>{c.resetResult(n),h(e)}}),(0,a.jsx)(ek.g,{serviceRoleLabel:"postgres",variant:D.pe?"connected-on-both":"connected-on-right","data-sentry-element":"RoleImpersonationPopover","data-sentry-source-file":"UtilityActions.tsx"}),(0,a.jsx)(eU.C,{hasSelection:r,isDisabled:s||t,isExecuting:t,className:"rounded-l-none min-w-[82px]",onClick:i,"data-sentry-element":"SqlRunButton","data-sentry-source-file":"UtilityActions.tsx"})]})})]})};var eB=t(23445),eY=t(32466),eQ=t(46312),ez=t(55006),eV=t(12578),eX=t(67575),eJ=t(33233),e$=t(52786),eZ=t(34378);let e0=(0,r.forwardRef)(e=>{var n,t,s,r,l,i,c,d,u,m,p,E,h;let{id:g,isExecuting:f,isDisabled:v,isDebugging:N,onDebug:x}=e,{ref:b}=(0,_.g)(),y=(0,P.RE)(),{data:I}=(0,O.s)(),T=(0,q.aP)(),[,S]=(0,eY.ZA)("showConnect",eY.cr.withDefault(!1)),A=null==(n=T.results[g])?void 0:n[0],{data:C}=(0,eJ.j5)({orgSlug:null==I?void 0:I.slug}),{data:R}=(0,eX.G)({projectRef:b}),L=(0,eQ.BP)(C)&&(null==R?void 0:R.is_sensitive),j=(null==A||null==(s=A.error)||null==(t=s.message)?void 0:t.includes("canceling statement due to statement timeout"))||(null==A||null==(l=A.error)||null==(r=l.message)?void 0:r.includes("upstream request timeout"))||(null==A||null==(c=A.error)||null==(i=c.message)?void 0:i.includes("Query read timeout")),D=null==A||null==(u=A.error)||null==(d=u.message)?void 0:d.includes("EHOSTUNREACH");if(f)return(0,a.jsxs)("div",{className:"flex items-center gap-x-4 px-6 py-4 bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark",children:[(0,a.jsx)(o.A,{size:14,className:"animate-spin"}),(0,a.jsx)("p",{className:"m-0 border-0 font-mono text-sm",children:"Running..."})]});if(null==A?void 0:A.error){let e=(null!=(h=null==(p=A.error)||null==(m=p.formattedError)?void 0:m.split("\n"))?h:[]).filter(e=>e.length>0),n=y.selectedDatabaseId!==b&&A.error.message.includes("in a read-only transaction"),t=A.error.message.includes("Query is too large to be run via the SQL Editor");return(0,a.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex flex-row justify-between items-start py-4 px-6 gap-x-4",children:[j?(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,a.jsx)("p",{className:"font-mono text-sm tracking-tight",children:"Error: SQL query ran into an upstream timeout"}),(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["You can either"," ",(0,a.jsx)(eV.g,{href:"https://supabase.com/docs/guides/platform/performance#examining-query-performance",children:"optimize your query"}),", or"," ",(0,a.jsx)(eV.g,{href:"https://supabase.com/docs/guides/database/timeouts",children:"increase the statement timeout"})," or ",(0,a.jsx)("span",{className:(0,K.cn)(eV.L,"cursor-pointer"),onClick:()=>S(!0),children:"connect to your database directly"}),"."]})]}):(0,a.jsxs)("div",{className:"flex flex-col gap-y-1",children:[e.length>0?e.map((e,n)=>(0,a.jsx)("pre",{className:"font-mono text-sm text-wrap",children:e},"error-".concat(n))):(0,a.jsxs)("p",{className:"font-mono text-sm tracking-tight",children:["Error: ",null==(E=A.error)?void 0:E.message]}),!j&&!D&&A.autoLimit&&(0,a.jsxs)("p",{className:"text-sm text-foreground-light",children:["Note: A limit of ",A.autoLimit,' was applied to your query. If this was the cause of a syntax error, try selecting "No limit" instead and re-run the query.']}),n&&(0,a.jsx)("p",{className:"text-sm text-foreground-light",children:"Note: Read replicas are for read only queries. Run write queries on the primary database instead."}),t&&(0,a.jsxs)("p",{className:"text-sm text-foreground-light flex items-center gap-x-1",children:["Run this query by"," ",(0,a.jsxs)("span",{onClick:()=>S(!0),className:(0,K.cn)(eV.L,"flex items-center gap-x-1"),children:["connecting to your database directly",(0,a.jsx)(eB.A,{size:12})]}),"."]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-x-2",children:[n&&(0,a.jsx)(Q.$,{className:"py-2",type:"default",onClick:()=>{y.setSelectedDatabaseId(b),T.resetResult(g)},children:"Switch to primary database"}),e.length>0&&(0,a.jsxs)(B.m_,{children:[(0,a.jsx)(B.k$,{children:(0,a.jsx)(ez.A,{iconOnly:!0,type:"default",text:e.join("\n")})}),(0,a.jsx)(B.ZI,{side:"bottom",align:"center",children:(0,a.jsx)("span",{children:"Copy error"})})]}),!L&&(0,a.jsx)(Q.$,{icon:(0,a.jsx)(e$.M,{size:16,loading:N}),disabled:!!v||N,onClick:x,children:"Debug with Assistant"})]})]})})}return A?A.rows.length<=0?(0,a.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,a.jsx)("p",{className:"m-0 border-0 px-6 py-4 font-mono text-sm",children:"Success. No rows returned"})}):(0,a.jsx)(eZ.A,{rows:A.rows}):(0,a.jsx)("div",{className:"bg-table-header-light [[data-theme*=dark]_&]:bg-table-header-dark overflow-y-auto",children:(0,a.jsxs)("p",{className:"m-0 border-0 px-4 py-4 text-sm text-foreground-light",children:["Click ",(0,a.jsx)("code",{children:"Run"})," to execute your query."]})})});e0.displayName="UtilityTabResults";let e1={type:"bar",cumulative:!1,xKey:"",yKey:"",showLabels:!1,showGrid:!1},e2=e=>{var n,t;let{id:s,isExecuting:r,isDebugging:l,isDisabled:i,hasSelection:o,prettifyQuery:c,executeQuery:d,onDebug:u}=e,{ref:p}=(0,_.g)(),{data:E}=(0,O.s)(),h=(0,q.aP)(),g=null==(n=h.snippets[s])?void 0:n.snippet,f=null==(t=h.results[s])?void 0:t[0],{mutate:v}=(0,C.h)(),{mutate:N}=(0,em.v)({invalidateQueriesOnSuccess:!1,onMutate:async e=>{let{payload:n}=e;if("sql"!==n.type||!("chart"in n.content))return;let t={...g,content:{...g.content,chart:n.content.chart}};h.updateSnippet({id:s,snippet:t})},onError:async(e,n,t)=>{m.oR.error("Failed to update chart. Please try again.")}}),x=function(){var e;return g&&"sql"===g.type&&(null==(e=g.content)?void 0:e.chart)?g.content.chart:e1}();return(0,a.jsxs)(e_.tU,{defaultValue:"results",className:"w-full h-full flex flex-col","data-sentry-element":"Tabs_Shadcn_","data-sentry-component":"UtilityPanel","data-sentry-source-file":"UtilityPanel.tsx",children:[(0,a.jsxs)(e_.j7,{className:"flex justify-between gap-2 px-4 overflow-x-auto min-h-[42px]","data-sentry-element":"TabsList_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(e_.Xi,{className:"py-3 text-xs",value:"results","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)("span",{className:"translate-y-[1px]",children:"Results"})}),(0,a.jsx)(e_.Xi,{className:"py-3 text-xs",value:"chart","data-sentry-element":"TabsTrigger_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)("span",{className:"translate-y-[1px]",children:"Chart"})}),(null==f?void 0:f.rows)&&(0,a.jsx)(eu.b,{type:"text",results:f.rows,fileName:"Supabase Snippet ".concat(g.name),onDownloadAsCSV:()=>{var e;return v({action:"sql_editor_result_download_csv_clicked",groups:{project:null!=p?p:"",organization:null!=(e=null==E?void 0:E.slug)?e:""}})},onCopyAsMarkdown:()=>{var e;v({action:"sql_editor_result_copy_markdown_clicked",groups:{project:null!=p?p:"",organization:null!=(e=null==E?void 0:E.slug)?e:""}})},onCopyAsJSON:()=>{var e;v({action:"sql_editor_result_copy_json_clicked",groups:{project:null!=p?p:"",organization:null!=(e=null==E?void 0:E.slug)?e:""}})}})]}),(0,a.jsx)(eK,{id:s,isExecuting:r,isDisabled:i,hasSelection:o,prettifyQuery:c,executeQuery:d,"data-sentry-element":"UtilityActions","data-sentry-source-file":"UtilityPanel.tsx"})]}),(0,a.jsx)(e_.av,{asChild:!0,value:"results",className:"mt-0 flex-grow","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)(e0,{id:s,isExecuting:r,isDisabled:i,onDebug:u,isDebugging:l,"data-sentry-element":"UtilityTabResults","data-sentry-source-file":"UtilityPanel.tsx"})}),(0,a.jsx)(e_.av,{asChild:!0,value:"chart",className:"mt-0 flex-grow","data-sentry-element":"TabsContent_Shadcn_","data-sentry-source-file":"UtilityPanel.tsx",children:(0,a.jsx)(eL,{results:f,config:x,onConfigChange:function(e){p&&(null==g?void 0:g.id)&&N({projectRef:p,payload:{...g,id:g.id,description:g.description||"",project_id:g.project_id||0,content:{...g.content,content_id:s,chart:e}}})},"data-sentry-element":"ChartConfig","data-sentry-source-file":"UtilityPanel.tsx"})})]})},e4=u()(()=>t.e(8211).then(t.bind(t,28211)),{loadableGenerated:{webpack:()=>[28211]},ssr:!1}),e3=u()(()=>Promise.resolve().then(t.bind(t,14360)).then(e=>{let{DiffEditor:n}=e;return n}),{loadableGenerated:{webpack:()=>[14360]},ssr:!1}),e6=()=>{var e,n,t;let l=(0,w.UX)(),d=(0,s.useRouter)(),{ref:u,id:g}=(0,_.g)(),{profile:f}=(0,k.xc)(),{data:v}=(0,j.YA)(),{data:N}=(0,O.s)(),x=(0,i.jE)(),b=(0,G.zv)(),V=(0,U.xd)(),X=(0,q.aP)(),en=(0,M.Qj)(),et=(0,P.RE)(),{includeSchemaMetadata:ea,isHipaaProjectDisallowed:es}=(0,R.KQ)(),[er]=function(e){let[n,t]=(0,L.U)(_.rS.SQL_EDITOR_AI_SCHEMA(e),["public"]);return e?[n,t]:[[],()=>{}]}(null==v?void 0:v.ref),{sourceSqlDiff:el,setSourceSqlDiff:ei,selectedDiffType:eo,setSelectedDiffType:ec,setIsAcceptDiffLoading:eu,isDiffOpen:em,defaultSqlDiff:e_,closeDiff:ep}=(0,z.yh)(),{promptState:eE,setPromptState:eh,promptInput:eg,setPromptInput:ef,resetPrompt:ev}=(0,z.tB)(),eN=(0,r.useRef)(null),ex=(0,r.useRef)(null),eb=(0,r.useRef)(null),ey=(0,r.useRef)(0),[eI,eT]=(0,r.useState)(!1),[eS,eA]=(0,r.useState)([]),[eC,eR]=(0,r.useState)(!1),[eL,eO]=(0,r.useState)(!1),[ej,eD]=(0,r.useState)(!1),[eF,ew]=(0,r.useState)(!1),[ek,eH]=(0,r.useState)(!1),eU=(0,r.useMemo)(()=>(0,w.gZ)(),[g]),eP=g&&"new"!==g?g:eU,eM=X.limit,eq=null==(e=X.results[eP])?void 0:e[0],eG=!(eP in X.snippets&&void 0!==X.snippets[eP].snippet.content),eW="new"!==g&&eG;ed(eP,ex.current);let{data:eK,isSuccess:eB}=(0,S.Vh)({projectRef:u},{enabled:(0,I.yF)(null==v?void 0:v.connectionString)}),{data:eY,refetch:eQ}=y({schemas:er,projectRef:null==v?void 0:v.ref,connectionString:null==v?void 0:v.connectionString},{enabled:(0,I.yF)(null==v?void 0:v.connectionString)&&ea}),ez=ea?null==eY?void 0:eY.map(e=>e.sql.trim()):void 0,{mutateAsync:eV}=(0,h.G)(),{mutate:eX}=(0,C.h)(),{mutate:eJ,isLoading:e$}=(0,A.Y)({onSuccess(e,n){eP&&X.addResult(eP,e.result,n.autoLimit),eQ(),x.invalidateQueries(T.O.lint(u))},onError(e,n){if(eP){if(e.position&&ex.current){var t,a,s;let n=eN.current,r=ex.current,l=eI&&null!=(a=null==n||null==(t=n.getSelection())?void 0:t.startLineNumber)?a:0,i=null!=(s=e.formattedError)?s:"",o=i.slice(i.indexOf("LINE")),c=l+Number(o.slice(0,o.indexOf(":")).split(" ")[1]);if(!isNaN(c)){let e=null==n?void 0:n.deltaDecorations([],[{range:new r.Range(c,1,c,20),options:{isWholeLine:!0,inlineClassName:"bg-warning-400"}}]);e&&(null==n||n.revealLineInCenter(c),eA(e))}}X.addResultError(eP,e,n.autoLimit)}}}),eZ=(0,r.useCallback)(async(e,n)=>{try{let{title:t}=await eV({sql:n});X.renameSnippet({id:e,name:t});let a=(0,G.lW)("sql",{id:e});b.updateTab(a,{label:t})}catch(e){}},[eV,X]),e0=(0,r.useCallback)(async()=>{if(em)return;let e=(0,q.Lv)().snippets[eP];if(eN.current&&v){var n,t,a,s,r,l;let i=eN.current,o=i.getSelection(),c=o?null==(n=i.getModel())?void 0:n.getValueInRange(o):void 0,d=e?null!=(l=c||(null==(t=eN.current)?void 0:t.getValue()))?l:null==(a=e.snippet.content)?void 0:a.sql:c||(null==(s=eN.current)?void 0:s.getValue()),u=(0,F.A)(d),m=null==eN||null==(r=eN.current)?void 0:r.getModel();eN.current&&m&&(eN.current.executeEdits("apply-prettify-edit",[{text:u,range:m.getFullModelRange()}]),X.setSql(eP,u))}},[eP,em,v,X]),e1=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(em)return;let n=(0,q.Lv)().snippets[eP];if(null!==eN.current&&!e$&&void 0!==v){var t,a,s,r,l,i,o;let c=eN.current,d=c.getSelection(),_=d?null==(t=c.getModel())?void 0:t.getValueInRange(d):void 0,p=n?null!=(i=_||(null==(a=eN.current)?void 0:a.getValue()))?i:null==(s=n.snippet.content)?void 0:s.sql:_||(null==(r=eN.current)?void 0:r.getValue()),E=!1,h=(0,ee.rs)(p);!e&&h&&(eO(!0),eD(!0),E=!0);let g=(0,ee.j8)(p);if(!e&&g&&(eO(!0),ew(!0),E=!0),E)return;es||(null==n?void 0:n.snippet.name)!==$.tO||eZ(eP,p),eS.length>0&&(null==c||c.deltaDecorations(eS,[]),eA([]));let f=en(),x=null==eK||null==(l=eK.find(e=>e.identifier===et.selectedDatabaseId))?void 0:l.connectionString;if(!(0,I.yF)(x))return m.oR.error("Unable to run query: Connection string is missing");let{appendAutoLimit:b}=(0,ee.iD)(p,eM),y=(0,ee.dZ)(p,eM);eJ({projectRef:v.ref,connectionString:x,sql:(0,H.Nf)(y,f),autoLimit:b?eM:void 0,isRoleImpersonationEnabled:(0,M._c)(f.role),isStatementTimeoutDisabled:!0,contextualInvalidation:!0,handleError:e=>{throw e}}),eX({action:"sql_editor_query_run_button_clicked",groups:{project:null!=u?u:"Unknown",organization:null!=(o=null==N?void 0:N.slug)?o:"Unknown"}})}},[em,eP,e$,v,es,eJ,en,eZ,et.selectedDatabaseId,eK,eM]),e6=(0,r.useCallback)(async(e,n)=>{if(!u)return console.error("Project ref is required");if(!f)return console.error("Profile is required");if(!v)return console.error("Project is required");try{let t=(0,ee.fW)({id:(0,w.gZ)(),name:n,sql:e,owner_id:f.id,project_id:v.id});X.addSnippet({projectRef:u,snippet:t}),X.addNeedsSaving(t.id),d.push("/project/".concat(u,"/sql/").concat(t.id))}catch(e){m.oR.error("Failed to create new query: ".concat(e.message))}},[null==f?void 0:f.id,null==v?void 0:v.id,u,d,X]),e5=(0,r.useCallback)(async()=>{try{var e,n,t;let a=X.snippets[eP],s=null==(e=X.results[eP])?void 0:e[0];V.newChat({name:"Debug SQL snippet",open:!0,sqlSnippets:[(null!=(t=null==(n=a.snippet.content)?void 0:n.sql)?t:"").replace($.Fl,"").trim()],initialInput:"Help me to debug the attached sql snippet which gives the following error: \n\n".concat(s.error.message)})}catch(e){(function(e){return!!e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message})(e)&&m.oR.error("Sorry, the assistant failed to debug your query! Please try again with a different one.")}},[ez,eP,X.results,X.snippets]),e7=(0,r.useCallback)(async()=>{try{var e;if(eu(!0),!el||!eN.current||!eb.current)return;let n=eN.current.getModel(),t=eb.current.getModel();if(!n||!t)return;let a=t.modified.getValue();if(eo===Z.s.NewSnippet){let{title:e}=await eV({sql:a});await e6(a,e)}else eN.current.executeEdits("apply-ai-edit",[{text:a,range:n.getFullModelRange()}]);eX({action:"assistant_sql_diff_handler_evaluated",properties:{handlerAccepted:!0},groups:{project:null!=u?u:"Unknown",organization:null!=(e=null==N?void 0:N.slug)?e:"Unknown"}}),ec(Z.s.Modification),ev(),ep()}finally{eu(!1)}},[el,eo,e6,eV,d,eP,X]),e8=(0,r.useCallback)(()=>{var e;eX({action:"assistant_sql_diff_handler_evaluated",properties:{handlerAccepted:!1},groups:{project:null!=u?u:"Unknown",organization:null!=(e=null==N?void 0:N.slug)?e:"Unknown"}}),ev(),ep()},[ep,ev,eX]),[e9,ne]=(0,r.useState)(!1),nn=(0,r.useCallback)(async(e,n)=>{var t,a,s,r,l,i,o,c;try{ne(!0);let e=await fetch("".concat(D.o2,"/api/ai/code/complete"),{method:"POST",headers:{"Content-Type":"application/json",...null!=(a=null==n?void 0:n.headers)?a:{}},body:JSON.stringify({projectRef:null==v?void 0:v.ref,connectionString:null==v?void 0:v.connectionString,language:"sql",orgSlug:null==N?void 0:N.slug,...null!=(s=null==n?void 0:n.body)?s:{}})});if(!e.ok){let n=await e.text();throw Error(n||"Failed to generate completion")}let c=await e.json(),d=null!=(r=null==n||null==(t=n.body)?void 0:t.completionMetadata)?r:{},u=null!=(l=d.textBeforeCursor)?l:"",m=null!=(i=d.textAfterCursor)?i:"",_=null!=(o=d.selection)?o:"",p=(0,F.A)(u+c+m);ei({original:u+_+m,modified:p}),ec(Z.s.Modification),eh(e=>({...e,isLoading:!1})),ne(!1)}catch(e){throw m.oR.error("Failed to generate SQL: ".concat(null!=(c=null==e?void 0:e.message)?c:"Unknown error")),ne(!1),e}},[null==N?void 0:N.slug,null==v?void 0:v.connectionString,null==v?void 0:v.ref,eh,ec,ei]),nt=async(e,n)=>{try{eh(e=>({...e,selection:n.selection,beforeSelection:n.beforeSelection,afterSelection:n.afterSelection}));let t=(await (0,I.We)()).get("Authorization");await nn(e,{...t?{headers:{Authorization:t}}:void 0,body:{completionMetadata:{textBeforeCursor:n.beforeSelection,textAfterCursor:n.afterSelection,language:"pgsql",prompt:e,selection:n.selection}}})}catch(e){eh(e=>({...e,isLoading:!1}))}};return(0,r.useEffect)(()=>(eP&&(ep(),eh(e=>({...e,isOpen:!1}))),()=>{if(u){let e=(0,G.lW)("sql",{id:eP});b.updateTab(e,{scrollTop:ey.current})}}),[ep,eP]),(0,r.useEffect)(()=>{let e=e=>{if(em||eE.isOpen)switch(e.key){case"Enter":("macos"===l?e.metaKey:e.ctrlKey)&&em&&(e7(),ev());return;case"Escape":var n;em&&e8(),ev(),null==(n=eN.current)||n.focus();return}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[l,em,eE.isOpen,e7,e8,ev]),(0,r.useEffect)(()=>{if(em){let e=eb.current,n=null==e?void 0:e.getModel();if(n&&n.original&&n.modified){n.original.setValue(e_.original),n.modified.setValue(e_.modified);let t=e.getModifiedEditor(),a=eE.startLineNumber;t.revealLineInCenter(a)}}},[eo,el]),(0,r.useEffect)(()=>{if(eB){let e=eK.find(e=>e.identifier===u);et.setSelectedDatabaseId(null==e?void 0:e.identifier)}},[eB,eK,u]),(0,r.useEffect)(()=>{if(void 0!==X.diffContent){var e,n,t,a,s;let{diffType:r,sql:l}=X.diffContent,i=null==(e=eN.current)?void 0:e.getModel();i&&(0===(null!=(t=null==(n=eN.current)?void 0:n.getValue())?t:"").length?null==(a=eN.current)||a.executeEdits("apply-ai-message",[{text:"".concat(l),range:i.getFullModelRange()}]):(ei({original:(null==(s=eN.current)?void 0:s.getValue())||"",modified:l}),ec(r)))}},[X.diffContent]),(0,r.useEffect)(()=>{if(em){if(eb.current&&eC)return eH(!0),()=>eH(!1)}else eR(!1),eH(!1)},[em,eC]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(J,{visible:eL,hasDestructiveOperations:ej,hasUpdateWithoutWhere:eF,onCancel:()=>{eO(!1),eD(!1),ew(!1),setTimeout(()=>{var e;return null==(e=eN.current)?void 0:e.focus()},100)},onConfirm:()=>{eO(!1),e1(!0)},"data-sentry-element":"RunQueryWarningModal","data-sentry-source-file":"SQLEditor.tsx"}),(0,a.jsx)("div",{className:"flex h-full",children:(0,a.jsxs)(W.HK,{className:"relative",direction:"vertical",autoSaveId:_.rS.SQL_EDITOR_SPLIT_SIZE,"data-sentry-element":"ResizablePanelGroup","data-sentry-source-file":"SQLEditor.tsx",children:[(0,a.jsx)(W.wV,{defaultSize:50,maxSize:70,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"SQLEditor.tsx",children:(0,a.jsx)("div",{className:"flex-grow overflow-y-auto border-b h-full",children:eW?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)(o.A,{className:"animate-spin text-brand"})}):(0,a.jsxs)(a.Fragment,{children:[em&&(0,a.jsxs)("div",{className:"w-full h-full",children:[(0,a.jsx)(e3,{theme:"supabase",language:"pgsql",original:e_.original,modified:e_.modified,onMount:e=>{eb.current=e,eR(!0)},options:{fontSize:13,renderSideBySide:!1,minimap:{enabled:!1},wordWrap:"on",lineNumbers:"on",folding:!1,padding:{top:4},lineNumbersMinChars:3}}),ek&&(0,a.jsx)(p.A,{editor:eb.current,id:"ask-ai-diff",value:eg,onChange:ef,onSubmit:e=>{nt(e,{beforeSelection:eE.beforeSelection,selection:eE.selection||e_.modified,afterSelection:eE.afterSelection})},onAccept:e7,onReject:e8,onCancel:ev,isDiffVisible:!0,isLoading:e9,startLineNumber:Math.max(0,eE.startLineNumber),endLineNumber:eE.endLineNumber})]}),(0,a.jsxs)("div",{className:"w-full h-full relative",children:[(0,a.jsx)(e4,{autoFocus:!0,placeholder:eE.isOpen||(null==(n=eN.current)?void 0:n.getValue())?"":"Hit "+("macos"===l?"CMD+K":"CTRL+K")+" to generate query or just start typing",id:eP,className:(0,K.cn)(em&&"hidden"),editorRef:eN,monacoRef:ex,executeQuery:e1,onHasSelection:eT,onMount:e=>{let n=(0,G.lW)("sql",{id:eP}),t=b.tabsMap[n];setTimeout(()=>{var n;(null==t||null==(n=t.metadata)?void 0:n.scrollTop)&&e.setScrollTop(t.metadata.scrollTop)},20),e.onDidScrollChange(e=>ey.current=e.scrollTop)},onPrompt:e=>{let{selection:n,beforeSelection:t,afterSelection:a,startLineNumber:s,endLineNumber:r}=e;eh(e=>({...e,isOpen:!0,selection:n,beforeSelection:t,afterSelection:a,startLineNumber:s,endLineNumber:r}))}}),eN.current&&eE.isOpen&&!em&&(0,a.jsx)(p.A,{editor:eN.current,id:"ask-ai",value:eg,onChange:ef,onSubmit:e=>{nt(e,{beforeSelection:eE.beforeSelection,selection:eE.selection,afterSelection:eE.afterSelection})},onCancel:ev,isDiffVisible:!1,isLoading:e9,startLineNumber:Math.max(0,eE.startLineNumber),endLineNumber:eE.endLineNumber})]},eP)]})})}),(0,a.jsx)(W.WM,{withHandle:!0,"data-sentry-element":"ResizableHandle","data-sentry-source-file":"SQLEditor.tsx"}),(0,a.jsx)(W.wV,{defaultSize:50,maxSize:70,"data-sentry-element":"ResizablePanel","data-sentry-source-file":"SQLEditor.tsx",children:eW?(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,a.jsx)(o.A,{className:"animate-spin text-brand"})}):(0,a.jsx)(e2,{id:eP,isExecuting:e$,isDisabled:em,hasSelection:eI,prettifyQuery:e0,executeQuery:e1,onDebug:e5})}),(0,a.jsx)("div",{className:"h-9",children:(null==eq?void 0:eq.rows)!==void 0&&!e$&&(0,a.jsxs)(E.C,{className:"flex items-center justify-between gap-2",children:[(0,a.jsxs)(B.m_,{children:[(0,a.jsx)(B.k$,{children:(0,a.jsxs)("p",{className:"text-xs",children:[(0,a.jsxs)("span",{className:"text-foreground",children:[eq.rows.length," row",eq.rows.length>1?"s":""]}),(0,a.jsx)("span",{className:"text-foreground-lighter ml-1",children:void 0!==eq.autoLimit&&" (Limited to only ".concat(eq.autoLimit," rows)")})]})}),(0,a.jsx)(B.ZI,{className:"max-w-xs",children:(0,a.jsxs)("p",{className:"flex flex-col gap-y-1",children:[(0,a.jsx)("span",{children:"Results are automatically limited to preserve browser performance, in particular if your query returns an exceptionally large number of rows."}),(0,a.jsx)("span",{className:"text-foreground-light",children:"You may change or remove this limit from the dropdown on the right"})]})})]}),void 0!==eq.autoLimit&&(0,a.jsxs)(Y.rI,{children:[(0,a.jsx)(Y.ty,{asChild:!0,children:(0,a.jsxs)(Q.$,{type:"default",iconRight:(0,a.jsx)(c.A,{size:14}),children:["Limit results to:"," ",null==(t=$.Lo.find(e=>e.value===X.limit))?void 0:t.label]})}),(0,a.jsx)(Y.SQ,{className:"w-40",align:"end",children:(0,a.jsx)(Y.Hr,{value:X.limit.toString(),onValueChange:e=>X.setLimit(Number(e)),children:$.Lo.map(e=>(0,a.jsx)(Y.Ht,{value:e.value.toString(),children:e.label},e.label))})})]})]})})]})})]})};var e5=t(96232),e7=t(93349),e8=t(69690),e9=t(67697),ne=t(23171),nn=t(21357),nt=t(37411);let na=()=>{let e=(0,s.useRouter)(),{id:n,ref:t,content:i,skip:o}=(0,l.g)(),c=(0,e8.l)(),d=(0,G.zv)(),u=(0,nt.qM)(),m=(0,q.aP)(),_=(0,q.wU)(t),p=_.find(e=>e.id===n),E=n?d.openTabs.find(e=>e.endsWith(n)):void 0,{data:h,error:g,isError:f}=(0,nn.K)({projectRef:t,id:n},{retry:!1,enabled:!!("new"!==n&&"function"==typeof m.addSnippet&&!(null==p?void 0:p.isNotSavedInDatabaseYet))}),v=f&&404===g.code&&g.message.includes("Content not found"),N=f&&400===g.code&&g.message.includes("Invalid uuid");return((0,r.useEffect)(()=>{t&&h&&m.setSnippet(t,h)},[t,h]),(0,r.useEffect)(()=>{"new"===n&&"true"!==o&&void 0!==u.dashboardHistory.sql&&void 0===i&&void 0!==_.find(e=>e.id===u.dashboardHistory.sql)&&e.push("/project/".concat(t,"/sql/").concat(u.dashboardHistory.sql))},[n,_,i]),(0,r.useEffect)(()=>{if(!e.isReady||!n||"new"===n)return;let t=(0,G.lW)("sql",{id:n}),a=_.find(e=>e.id===n);d.addTab({id:t,type:"sql",label:(null==a?void 0:a.name)||"Untitled Query",metadata:{sqlId:n,name:null==a?void 0:a.name}})},[e.isReady,n]),v||N)?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("div",{className:"w-[400px]",children:(0,a.jsx)(eA.Z,{type:"default",title:"Unable to find snippet with ID ".concat(n),description:"This snippet doesn't exist in your project",children:E?(0,a.jsx)(Q.$,{type:"default",className:"mt-2",onClick:()=>{d.handleTabClose({id:E,router:e,editor:c,onClearDashboardHistory:()=>{t&&u.setDashboardHistory(t,"sql",void 0)}})},children:"Close tab"}):(0,a.jsx)(Q.$,{asChild:!0,type:"default",className:"mt-2",children:(0,a.jsx)(eb(),{href:"/project/".concat(t,"/sql"),children:"Head back"})})})})}):(0,a.jsx)(e6,{"data-sentry-element":"SQLEditor","data-sentry-component":"SqlEditor","data-sentry-source-file":"[id].tsx"})};na.getLayout=e=>(0,a.jsx)(e5.A,{children:(0,a.jsx)(e7.$,{productMenu:(0,a.jsx)(ne.Z,{}),product:"SQL Editor",children:(0,a.jsx)(e9.A,{children:e})})});let ns=na},82675:(e,n,t)=>{"use strict";t.d(n,{A:()=>o});var a=t(80263),s=t(29046),r=t(51500),l=t(1128),i=t(55219);let o=e=>{let{attribute:n,message:t="No data to show",description:o,format:c,className:d="",size:u}=e,{minHeight:m}=(0,i.dQ)(u);return(0,a.jsxs)("div",{"data-sentry-component":"NoDataPlaceholder","data-sentry-source-file":"NoDataPlaceholder.tsx",children:[void 0!==n&&(0,a.jsx)(l._,{title:n,format:c,highlightedValue:0}),(0,a.jsxs)("div",{className:(0,r.cn)("border-control flex flex-grow w-full flex-col items-center justify-center space-y-2 border border-dashed text-center",d),style:{minHeight:m+20},children:[(0,a.jsx)(s.A,{size:20,className:"text-border-stronger","data-sentry-element":"BarChart2","data-sentry-source-file":"NoDataPlaceholder.tsx"}),(0,a.jsxs)("div",{className:"px-1",children:[(0,a.jsx)("p",{className:"text-foreground-light text-xs",children:t}),o&&(0,a.jsx)("p",{className:"text-foreground-lighter text-xs",children:o})]})]})]})}},92303:(e,n,t)=>{"use strict";t.d(n,{e:()=>c});var a=t(47319),s=t(56947),r=t(92403),l=t(15629);let i=a.A.functions.list();async function o(e,n,t){let{projectRef:a,connectionString:s}=e,r=new Headers(t),{result:o}=await (0,l.E)({projectRef:a,connectionString:s,sql:i.sql,queryKey:["database-functions"]},n,r);return o}let c=function(e){let{projectRef:n,connectionString:t}=e,{enabled:a=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.I)(r.c.databaseFunctions(n),e=>{let{signal:a}=e;return o({projectRef:n,connectionString:t},a)},{enabled:a&&void 0!==n,...l})}}},e=>{var n=n=>e(e.s=n);e.O(0,[6593,89,2313,9441,7494,4280,7598,4915,4560,6797,4674,2360,6110,6712,7795,4968,876,5089,9239,1895,3709,5573,9897,6585,279,6692,4856,6348,7686,8343,2690,6232,597,8119,1533,1444,5957,4034,3331,636,8792],()=>n(30287)),_N_E=e.O()}]);